<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <script type="application/javascript" src='https://yuweizzz.github.io/js/theme-mode.js'></script>
    <link rel="stylesheet" href='https://yuweizzz.github.io/css/frameworks.min.css' />
    <link rel="stylesheet" href='https://yuweizzz.github.io/css/github.min.css' />
    <link rel="stylesheet" href='https://yuweizzz.github.io/css/github-style.css' />
    <link rel="stylesheet" href='https://yuweizzz.github.io/css/light.css' />
    <link rel="stylesheet" href='https://yuweizzz.github.io/css/dark.css' />
    <link rel="stylesheet" href='https://yuweizzz.github.io/css/syntax.css' />
    <title>常用 Linux 命令和 Shell 技巧笔记 - Wei&#39;s blog</title>
    
    <link rel="icon" type="image/x-icon" href='/images/github.png'>
    
    <meta name="theme-color" content="#1e2327">

    
    <meta name="description"
  content="这篇笔记用来记录 Linux 下常用命令和一些实用 Shell 技巧。
" />
<meta name="keywords"
  content='blog, google analytics' />
<meta name="robots" content="noodp" />
<link rel="canonical" href="https://yuweizzz.github.io/post/practical_tips_in_linux/" />


<meta name="twitter:card" content="summary" />
<meta name="twitter:title" content="常用 Linux 命令和 Shell 技巧笔记 - Wei&#39;s blog" />
<meta name="twitter:description"
  content="这篇笔记用来记录 Linux 下常用命令和一些实用 Shell 技巧。
" />
<meta name="twitter:site" content="https://yuweizzz.github.io" />
<meta name="twitter:creator" content="" />
<meta name="twitter:image"
  content="https://yuweizzz.github.io">


<meta property="og:type" content="article" />
<meta property="og:title" content="常用 Linux 命令和 Shell 技巧笔记 - Wei&#39;s blog">
<meta property="og:description"
  content="这篇笔记用来记录 Linux 下常用命令和一些实用 Shell 技巧。
" />
<meta property="og:url" content="https://yuweizzz.github.io/post/practical_tips_in_linux/" />
<meta property="og:site_name" content="常用 Linux 命令和 Shell 技巧笔记" />
<meta property="og:image"
  content="https://yuweizzz.github.io">
<meta property="og:image:width" content="2048">
<meta property="og:image:height" content="1024">

<meta property="article:published_time" content="2021-07-23 15:00:00 &#43;0000 UTC" />










</head>

<body>
  <div style="position: relative">
  <header class="Header js-details-container Details px-3 px-md-4 px-lg-5 flex-wrap flex-md-nowrap open Details--on">
    <div class="Header-item mobile-none" style="margin-top: -4px; margin-bottom: -4px;">
      <a class="Header-link" href="https://yuweizzz.github.io">
        <svg class="octicon" height="32" viewBox="0 0 16 16" version="1.1" width="32">
          <path fill-rule="evenodd"
            d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z">
          </path>
        </svg>
      </a>
    </div>
    <div class="Header-item d-md-none">
      <button class="Header-link btn-link js-details-target" type="button"
        onclick="document.querySelector('#header-search').style.display = document.querySelector('#header-search').style.display == 'none'? 'block': 'none'">
        <svg height="24" class="octicon octicon-three-bars" viewBox="0 0 16 16" version="1.1" width="24">
          <path fill-rule="evenodd"
            d="M1 2.75A.75.75 0 011.75 2h12.5a.75.75 0 110 1.5H1.75A.75.75 0 011 2.75zm0 5A.75.75 0 011.75 7h12.5a.75.75 0 110 1.5H1.75A.75.75 0 011 7.75zM1.75 12a.75.75 0 100 1.5h12.5a.75.75 0 100-1.5H1.75z">
          </path>
        </svg>
      </button>
    </div>
    <div style="display: none;" id="header-search"
      class="Header-item Header-item--full flex-column flex-md-row width-full flex-order-2 flex-md-order-none mr-0 mr-md-3 mt-3 mt-md-0 Details-content--hidden-not-important d-md-flex">
      <div
        class="Header-search header-search flex-auto js-site-search position-relative flex-self-stretch flex-md-self-auto mb-3 mb-md-0 mr-0 mr-md-3 scoped-search site-scoped-search js-jump-to">
        <div class="position-relative">
          <form target="_blank" action="https://www.google.com/search" accept-charset="UTF-8" method="get"
            autocomplete="off">
            <label
              class="Header-search-label form-control input-sm header-search-wrapper p-0 js-chromeless-input-container header-search-wrapper-jump-to position-relative d-flex flex-justify-between flex-items-center">
              <input type="text"
                class="Header-search-input form-control input-sm header-search-input jump-to-field js-jump-to-field js-site-search-focus js-site-search-field is-clearable"
                name="q" value="" placeholder="Search" autocomplete="off">
              <input type="hidden" name="q" value="site:https://yuweizzz.github.io">
            </label>
          </form>
        </div>
      </div>
    </div>

    <div class="Header-item Header-item--full flex-justify-center d-md-none position-relative">
      <a class="Header-link " href="https://yuweizzz.github.io">
        <svg class="octicon octicon-mark-github v-align-middle" height="32" viewBox="0 0 16 16" version="1.1"
          width="32">
          <path fill-rule="evenodd"
            d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z">
          </path>
        </svg>
      </a>
    </div>
    <div class="Header-item" style="margin-right: 0;">
      <a href="javascript:void(0)" class="Header-link no-select" onclick="switchTheme()">
        <svg style="fill: var(--color-profile-color-modes-toggle-moon);" class="no-select" viewBox="0 0 16 16"
          version="1.1" width="16" height="16">
          <path fill-rule="evenodd" clip-rule="evenodd"
            d="M4.52208 7.71754C7.5782 7.71754 10.0557 5.24006 10.0557 2.18394C10.0557 1.93498 10.0392 1.68986 10.0074 1.44961C9.95801 1.07727 10.3495 0.771159 10.6474 0.99992C12.1153 2.12716 13.0615 3.89999 13.0615 5.89383C13.0615 9.29958 10.3006 12.0605 6.89485 12.0605C3.95334 12.0605 1.49286 10.001 0.876728 7.24527C0.794841 6.87902 1.23668 6.65289 1.55321 6.85451C2.41106 7.40095 3.4296 7.71754 4.52208 7.71754Z">
          </path>
        </svg>
      </a>
    </div>
  </header>
</div>
  
<script src="https://unpkg.com/@popperjs/core@2"></script>
<script src="https://unpkg.com/tippy.js@6"></script>
<div>
  <main>
    <div class="gisthead pagehead bg-gray-light pb-0 pt-3 mb-4">
      <div class="px-0">
        <div class="mb-3 d-flex px-3 px-md-3 px-lg-5">
          <div class="flex-auto min-width-0 width-fit mr-3">
            <div class="d-flex">
              <div class="d-none d-md-block">
                <a class="avatar mr-2 flex-shrink-0" href="https://yuweizzz.github.io">
                  <img class=" avatar-user"
                    src="https://yuweizzz.github.io/images/avatar.png"
                    width="32" height="32"></a>
              </div>
              <div class="d-flex flex-column">
                <h1 class="break-word f3 text-normal mb-md-0 mb-1">
                  <span class="author">
                    <a href="https://yuweizzz.github.io">Wei</a></span><span
                    class="path-divider">/</span><strong class="css-truncate-target mr-1" style="max-width: 410px"><a
                      href="https://yuweizzz.github.io/post/practical_tips_in_linux/">常用 Linux 命令和 Shell 技巧笔记</a></strong>
                </h1>
                <div class="note m-0">
                  Created <relative-time datetime="Fri, 23 Jul 2021 15:00:00 &#43;0000"
                    class="no-wrap">
                    Fri, 23 Jul 2021 15:00:00 &#43;0000</relative-time>

                  
                  <span class="file-info-divider"></span>
                  Modified <relative-time datetime="Fri, 21 Jan 2022 14:11:30 &#43;0000"
                    class="no-wrap">
                    Fri, 21 Jan 2022 14:11:30 &#43;0000</relative-time>
                  
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="container-lg px-3 new-discussion-timeline">
      <div class="repository-content gist-content">
        <div>
          <div class="js-gist-file-update-container js-task-list-container file-box">
            <div id="file-pytest" class="file my-2">
              <div id="post-header" class="file-header d-flex flex-md-items-center flex-items-start sticky-header">
                <div class="file-info d-flex flex-md-items-center flex-items-start flex-order-1 flex-auto">
                  <div class="text-mono f6 flex-auto pr-3 flex-order-2 flex-md-order-1 mt-2 mt-md-0">
                    
                    <summary id="toc-toggle" class="btn btn-octicon m-0 mr-2 p-2" aria-haspopup="menu" aria-label="Table of Contents" role="button">
                      <svg aria-hidden="true" viewBox="0 0 16 16" height="16" width="16" class="octicon octicon-list-unordered">
                        <path fill-rule="evenodd" d="M2 4a1 1 0 100-2 1 1 0 000 2zm3.75-1.5a.75.75 0 000 1.5h8.5a.75.75 0 000-1.5h-8.5zm0 5a.75.75 0 000 1.5h8.5a.75.75 0 000-1.5h-8.5zm0 5a.75.75 0 000 1.5h8.5a.75.75 0 000-1.5h-8.5zM3 8a1 1 0 11-2 0 1 1 0 012 0zm-1 6a1 1 0 100-2 1 1 0 000 2z"></path>
                      </svg>
                    </summary>
                          4292 Words
                    

                  </div>
                  <div class="file-actions flex-order-2 pt-0">
                    
                    
                    <a class="muted-link mr-3" href="/tags/linux">
                      <svg class="octicon octicon-tag" viewBox="0 0 16 16" version="1.1" width="16" height="16">
                        <path fill-rule="evenodd"
                          d="M2.5 7.775V2.75a.25.25 0 01.25-.25h5.025a.25.25 0 01.177.073l6.25 6.25a.25.25 0 010 .354l-5.025 5.025a.25.25 0 01-.354 0l-6.25-6.25a.25.25 0 01-.073-.177zm-1.5 0V2.75C1 1.784 1.784 1 2.75 1h5.025c.464 0 .91.184 1.238.513l6.25 6.25a1.75 1.75 0 010 2.474l-5.026 5.026a1.75 1.75 0 01-2.474 0l-6.25-6.25A1.75 1.75 0 011 7.775zM6 5a1 1 0 100 2 1 1 0 000-2z">
                        </path>
                      </svg>
                      Linux
                    </a>
                    
                    <a class="muted-link mr-3" href="/tags/shell">
                      <svg class="octicon octicon-tag" viewBox="0 0 16 16" version="1.1" width="16" height="16">
                        <path fill-rule="evenodd"
                          d="M2.5 7.775V2.75a.25.25 0 01.25-.25h5.025a.25.25 0 01.177.073l6.25 6.25a.25.25 0 010 .354l-5.025 5.025a.25.25 0 01-.354 0l-6.25-6.25a.25.25 0 01-.073-.177zm-1.5 0V2.75C1 1.784 1.784 1 2.75 1h5.025c.464 0 .91.184 1.238.513l6.25 6.25a1.75 1.75 0 010 2.474l-5.026 5.026a1.75 1.75 0 01-2.474 0l-6.25-6.25A1.75 1.75 0 011 7.775zM6 5a1 1 0 100 2 1 1 0 000-2z">
                        </path>
                      </svg>
                      Shell
                    </a>
                    
                    
                  </div>
                </div>
              </div>


              <div class="Box-body px-5 pb-5">
                <article class="markdown-body entry-content container-lg"><p>这篇笔记用来记录 Linux 下常用命令和一些实用 Shell 技巧。</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">
                                       <span class="o">(</span>@@<span class="o">)</span> <span class="o">(</span>  <span class="o">)</span> <span class="o">(</span>@<span class="o">)</span>  <span class="o">(</span> <span class="o">)</span>  @@    <span class="o">()</span>    @     O     @     O      @
                                  <span class="o">(</span>   <span class="o">)</span>
                              <span class="o">(</span>@@@@<span class="o">)</span>
                           <span class="o">(</span>    <span class="o">)</span>

                         <span class="o">(</span>@@@<span class="o">)</span>
                       <span class="o">====</span>        ________                ___________
                   _D _<span class="p">|</span>  <span class="p">|</span>_______/        <span class="se">\_</span>_I_I_____<span class="o">===</span>__<span class="p">|</span>_________<span class="p">|</span>
                    <span class="p">|</span><span class="o">(</span>_<span class="o">)</span>---  <span class="p">|</span>   H<span class="se">\_</span>_______/ <span class="p">|</span>   <span class="p">|</span>        <span class="o">=</span><span class="p">|</span>___ ___<span class="p">|</span>      _________________
                    /     <span class="p">|</span>  <span class="p">|</span>   H  <span class="p">|</span>  <span class="p">|</span>     <span class="p">|</span>   <span class="p">|</span>         <span class="o">||</span>_<span class="p">|</span> <span class="p">|</span>_<span class="o">||</span>     _<span class="p">|</span>                <span class="se">\_</span>____A
                   <span class="p">|</span>      <span class="p">|</span>  <span class="p">|</span>   H  <span class="p">|</span>__--------------------<span class="p">|</span> <span class="o">[</span>___<span class="o">]</span> <span class="p">|</span>   <span class="o">=</span><span class="p">|</span>                        <span class="p">|</span>
                   <span class="p">|</span> ________<span class="p">|</span>___H__/__<span class="p">|</span>_____/<span class="o">[][]</span>~<span class="se">\_</span>______<span class="p">|</span>       <span class="p">|</span>   -<span class="p">|</span>                        <span class="p">|</span>
                   <span class="p">|</span>/ <span class="p">|</span>   <span class="p">|</span>-----------I_____I <span class="o">[][]</span> <span class="o">[]</span>  D   <span class="p">|</span><span class="o">=======</span><span class="p">|</span>____<span class="p">|</span>________________________<span class="p">|</span>_
                 __/ <span class="o">=</span><span class="p">|</span> o <span class="p">|</span><span class="o">=</span>-~O<span class="o">=====</span><span class="nv">O</span><span class="o">=====</span><span class="nv">O</span><span class="o">=====</span>O<span class="se">\ </span>____Y___________<span class="p">|</span>__<span class="p">|</span>__________________________<span class="p">|</span>_
                  <span class="p">|</span>/-<span class="o">=</span><span class="p">|</span>___<span class="p">|</span><span class="o">=</span>    <span class="o">||</span>    <span class="o">||</span>    <span class="o">||</span>    <span class="p">|</span>_____/~<span class="se">\_</span>__/          <span class="p">|</span>_D__D__D_<span class="p">|</span>  <span class="p">|</span>_D__D__D_<span class="p">|</span>
                   <span class="se">\_</span>/      <span class="se">\_</span>_/  <span class="se">\_</span>_/  <span class="se">\_</span>_/  <span class="se">\_</span>_/      <span class="se">\_</span>/               <span class="se">\_</span>/   <span class="se">\_</span>/    <span class="se">\_</span>/   <span class="se">\_</span>/

</code></pre></div><h2 id="linux的归档和压缩命令">Linux的归档和压缩命令</h2>
<p>归档压缩是经常需要进行的操作，在 Linux 系统中基本上通过 tar 就可以应对大部分场景，某些特殊的场景可能会涉及 zip ， 7z ， rar 这些不同的压缩文件格式，它们需要使用额外的工具去操作，这里只介绍 tar 命令。</p>
<p>我们通常会使用 tar 对一系列文件进行归档打包，生成一个新的文件，但是新生成的打包文件我们可以自行决定是否压缩。所以归档打包和压缩不是同一概念，只是它们通常是紧密结合在一起的。</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash"><span class="c1"># 归档实例：</span>

<span class="c1"># 打包目录</span>
$ tar -cvf output.tar /mydir
<span class="c1"># -c 代表创建打包文件</span>
<span class="c1"># -v 代表显示详细过程</span>
<span class="c1"># -f 命名生成的打包文件</span>
<span class="c1"># 这一般是打包文件的最小操作命令，将 /mydir 打包为 output.tar</span>

<span class="c1"># 打包文件并进行压缩</span>
$ tar -cvzpf output.tar.gz /mydir
$ tar -cvjpf output.tar.bz2 /mydir
$ tar -cvJpf output.tar.xz /mydir
<span class="c1"># -j 代表使用 bzip2 压缩</span>
<span class="c1"># -z 代表使用 gzip 压缩</span>
<span class="c1"># -J 代表使用 xz 进行压缩</span>
<span class="c1"># -p 代表使用原来的文件权限还原文件</span>
<span class="c1"># 这是带了压缩命令的打包文件，以上三种压缩格式都是比较常用的</span>
<span class="c1"># 命名可以任意，一般保持通用的命名规则</span>

<span class="c1"># 解包文件</span>
$ tar -xvf output.tar -C /mydir
<span class="c1"># -x 代表解压文件操作</span>
<span class="c1"># -f 代表进行操作的文件</span>
<span class="c1"># -C 用来指定解压的路径</span>
<span class="c1"># 这一般是解压文件的通用命令，可以不指定压缩格式，tar 会自动适配</span>

<span class="c1"># 指定的压缩格式解压文件</span>
$ tar -xvJf output.tar.xz -C /mydir
<span class="c1"># 可以指定对应的压缩格式</span>
</code></pre></div><h2 id="硬盘分区和格式化">硬盘分区和格式化</h2>
<p>硬盘需要进行分区和格式化之后才能使用，现阶段主流的硬盘分区方式是 GPT ，小容量的硬盘和系统盘还经常会使用 msdos 。常用的分区工具有 parted ， fdisk ， gdisk 这几个，文件系统格式化一般使用 mkfs 命令。</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash"><span class="c1"># fdisk 只能支持 msdos 分区</span>
<span class="c1"># gdisk 在 fdisk 的基础上扩展 gpt 的功能</span>
<span class="c1"># 推荐使用 parted ，它拥有更全面的功能</span>

<span class="c1"># 查看已有分区信息</span>
$ parted /dev/sda print     

<span class="c1"># 以下命令具有一定危险，需要注意数据安全</span>
<span class="c1"># 设置分区表格式</span>
$ parted /dev/sda mklabel <span class="o">[</span> gpt <span class="p">|</span> msdos <span class="o">]</span>

<span class="c1"># 新增分区</span>
$ parted /dev/sda mkpart <span class="o">[</span> primary <span class="p">|</span> extended <span class="p">|</span> logical <span class="o">]</span> <span class="o">[</span> ext4 <span class="p">|</span> xfs <span class="o">]</span> start end
<span class="c1"># gpt 不区分分区类型，这里会以 Name 代替， msdos 需要用到 primary ， extended 和 logical 分区</span>
<span class="c1"># 文件系统的标记一般可以不写</span>
<span class="c1"># 分区范围是必填项</span>

<span class="c1"># 删除某一分区， Number 代表分区编号</span>
$ parted /dev/sda rm Number

<span class="c1"># 格式化分区</span>
$ mkfs.ext4 <span class="o">[</span>-b size<span class="o">]</span> <span class="o">[</span>-L label<span class="o">]</span> /dev/sda1
$ mkfs.xfs <span class="o">[</span>-b size<span class="o">]</span> <span class="o">[</span>-L label<span class="o">]</span> /dev/sda1
<span class="c1"># 两种最常用的文件系统，参数都是相近的</span>
<span class="c1"># -b 用来设定最小区块大小，有1K，2K，4K</span>
<span class="c1"># -L 用来设置文件系统标签，用于挂载文件系统</span>

<span class="c1"># 速用脚本</span>
$ parted /dev/sda -s mklabel gpt
$ parted /dev/sda -s mkpart primary 0% 100%  <span class="c1"># 这里的 primary 为分区命名，可以自行定义</span>
<span class="c1"># -s 用来屏蔽 parted 的交互信息</span>
$ mkfs.xfs /dev/sda1
</code></pre></div><h2 id="curl的基本使用">curl的基本使用</h2>
<p>curl 在 Linux 代替了浏览器的工作，经常用来调试接口。</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash"><span class="c1"># 经典 curl 用例</span>
$ curl -X POST -d <span class="s1">&#39;{&#34;key&#34;:&#34;value&#34;}&#39;</span> -H <span class="s1">&#39;Content-Type: application/json&#39;</span> http://....
<span class="c1"># -X HTTP请求方法，通常有GET,POST,PUT,DELETE</span>
<span class="c1"># -d body，常用于POST方法的请求体</span>
<span class="c1"># -H header，定义HTTP请求头</span>

<span class="c1"># 这里列举其他常用的参数</span>
<span class="c1"># -b 用来设置 cookie ，常以 -b &#39;key1=value1;key2=value2&#39; 的形式出现</span>
<span class="c1"># -k 用来请求 https 协议时跳过证书认证</span>
<span class="c1"># -i 用来额外输出请求的响应头，响应体正常输出</span>
<span class="c1"># -I 使用这个参数后只输出请求的响应头，响应体不再输出</span>
<span class="c1"># -x 用来设置代理服务器，用法为 -x/--proxy 127.0.0.1:8080</span>
</code></pre></div><h2 id="curl结合bash变量使用">curl结合bash变量使用</h2>
<p>curl 可以结合 bash 变量，实现更灵活的 url 请求。</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash"><span class="c1"># 结合 bash 变量的简单实例</span>
$ <span class="nv">keyA</span><span class="o">=</span>AAA
$ <span class="nv">keyB</span><span class="o">=</span>BBB
$ curl -X POST -H <span class="s1">&#39;Content-Type: application/json&#39;</span> -d <span class="s1">&#39;{&#34;keyA&#34;: &#34;&#39;</span><span class="s2">&#34;</span><span class="nv">$keyA</span><span class="s2">&#34;</span><span class="s1">&#39;&#34;,&#34;keyA&#34;: &#34;&#39;</span><span class="s2">&#34;</span><span class="nv">$keyB</span><span class="s2">&#34;</span><span class="s1">&#39;&#34;}&#39;</span> http://....
</code></pre></div><p>可以看到，这个过程使用了大量的 <code>'</code> 和 <code>&quot;</code> ，可以将其细分为五块：</p>
<ul>
<li><code>'{&quot;keyA&quot;: &quot;'</code></li>
<li><code>&quot;$keyA&quot;</code></li>
<li><code>'&quot;,&quot;keyA&quot;: &quot;'</code></li>
<li><code>&quot;$keyB&quot;</code></li>
<li><code>'&quot;}'</code></li>
</ul>
<p>其中 <code>'</code> 包围的文本不会被 bash 转义，所以 <code>{}</code> 会以源文本的格式保留而不被转义。而变量总是以 <code>&quot;$keyA&quot;</code> 的形式出现，保证它被 bash 正确转义并获取变量内容。所以文本块就是 <code>'</code> 包围的部分和变量转义后的组合文本，注意 <code>&quot;$keyA&quot;</code> 和任意 <code>'</code> 包围的部分之间不能有空格，这样它们就会被认为是完整的 <code>-d</code> 选项的内容，发起请求时就不会报错了。</p>
<h2 id="使用sed快速去除无用字符">使用sed快速去除无用字符</h2>
<p>sed 可以很简单快速去除空白行，首尾空白字符，注释行。</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash"><span class="c1"># 删除空白行</span>
$ sed <span class="s1">&#39;/^$/d&#39;</span>

<span class="c1"># 删除行左边的空白字符</span>
$ sed <span class="s1">&#39;s/^[ \t]*//g&#39;</span>

<span class="c1"># 删除行右边的空白字符</span>
$ sed <span class="s1">&#39;s/[ \t]*$//g&#39;</span>

<span class="c1"># 删除注释行</span>
$ sed <span class="s1">&#39;/^#/d&#39;</span>
<span class="c1"># 可能要配合删除左侧空白字符使用</span>

<span class="c1"># 实现上述操作基于正则表达式：</span>
<span class="c1"># $ 代表行尾</span>
<span class="c1"># ^ 代表行首</span>
<span class="c1"># [] 整体代表一个字符，[] 里面是字符范围</span>
<span class="c1"># 在上面的操作中，[ \t] 用来匹配 &#39; &#39; 或 &#39;\t&#39; 任意一种</span>
<span class="c1"># * 表示一个或多个，可以结合确定的单个字符或者字符范围使用</span>
</code></pre></div><h2 id="在shell中使用数组">在shell中使用数组</h2>
<p>bash 4 原生支持一维数组，在某些情况下可能会使用到这种数据结构。</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash"><span class="cp">#!/bin/bash
</span><span class="cp"></span><span class="c1"># 使用之前需要先声明数组</span>
<span class="nb">declare</span> -a array
<span class="nb">declare</span> -A Array
<span class="c1"># -a 声明的数组是普通的一维数组， index 只能是0,1,2,...</span>
<span class="c1"># -A 声明的数组是关联数组，类似于 python 的字典， index 可以自由定义</span>
<span class="c1"># 推荐使用 -A ，因为关联数组的兼容性比较好，它可以模拟普通数组，</span>
<span class="c1"># 而普通数组无法实现关联数组的特性</span>

<span class="c1"># 数组赋值</span>
<span class="nv">array</span><span class="o">=(</span><span class="m">1</span> <span class="m">2</span> <span class="m">3</span> 4<span class="o">)</span>
<span class="nv">Array</span><span class="o">=([</span>A<span class="o">]=</span><span class="m">1</span> <span class="o">[</span>B<span class="o">]=</span><span class="m">2</span> <span class="o">[</span>C<span class="o">]=</span><span class="m">3</span> <span class="o">[</span>D<span class="o">]=</span>4<span class="o">)</span>

<span class="c1"># 或者直接定义 index 和 value</span>
Array<span class="o">[</span><span class="s2">&#34;index&#34;</span><span class="o">]=</span>vaule

<span class="c1"># 遍历 index</span>
<span class="c1"># 使用 * 和 @ 均可</span>
<span class="k">for</span> i in <span class="si">${</span><span class="p">!array[*]</span><span class="si">}</span><span class="p">;</span> <span class="k">do</span> <span class="nb">echo</span> <span class="nv">$i</span><span class="p">;</span> <span class="k">done</span><span class="p">;</span>
<span class="k">for</span> i in <span class="si">${</span><span class="p">!array[@]</span><span class="si">}</span><span class="p">;</span> <span class="k">do</span> <span class="nb">echo</span> <span class="nv">$i</span><span class="p">;</span> <span class="k">done</span><span class="p">;</span>

<span class="c1"># 遍历 value ，和 index 类似</span>
<span class="k">for</span> i in <span class="si">${</span><span class="nv">array</span><span class="p">[*]</span><span class="si">}</span><span class="p">;</span> <span class="k">do</span> <span class="nb">echo</span> <span class="nv">$i</span><span class="p">;</span> <span class="k">done</span><span class="p">;</span>
<span class="k">for</span> i in <span class="si">${</span><span class="nv">array</span><span class="p">[@]</span><span class="si">}</span><span class="p">;</span> <span class="k">do</span> <span class="nb">echo</span> <span class="nv">$i</span><span class="p">;</span> <span class="k">done</span><span class="p">;</span>

<span class="c1"># 获取数组的元素个数</span>
<span class="nb">echo</span> <span class="si">${#</span><span class="nv">array</span><span class="p">[*]</span><span class="si">}</span><span class="p">;</span>
<span class="nb">echo</span> <span class="si">${#</span><span class="nv">array</span><span class="p">[@]</span><span class="si">}</span><span class="p">;</span>
<span class="c1"># 如果指定了确切的 index ，将会获取对应 value 的长度</span>
<span class="nb">echo</span> <span class="si">${#</span><span class="nv">array</span><span class="p">[</span><span class="s2">&#34;index&#34;</span><span class="p">]</span><span class="si">}</span><span class="p">;</span>
</code></pre></div><h2 id="bash变量操作符">bash变量操作符</h2>
<p>bash 变量支持操作符，可以基于原有值做一些快速变换。</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">$ <span class="nv">var</span><span class="o">=</span>file.name.sh
<span class="c1"># 修改第一个匹配字符 . 为 _</span>
$ <span class="nb">echo</span> <span class="si">${</span><span class="nv">var</span><span class="p">/./_</span><span class="si">}</span>
file_name.sh

<span class="c1"># 修改所有匹配字符 . 为 _</span>
$ <span class="nb">echo</span> <span class="si">${</span><span class="nv">var</span><span class="p">//./_</span><span class="si">}</span>
file_name_sh

<span class="c1"># 将表达式从左到右进行匹配，删除匹配的部分，可以使用通配符</span>
$ <span class="nb">echo</span> <span class="si">${</span><span class="nv">var</span><span class="p">#*.</span><span class="si">}</span>
name.sh

<span class="c1"># 从左到右进行匹配的贪婪模式</span>
$ <span class="nb">echo</span> <span class="si">${</span><span class="nv">var</span><span class="p">##*.</span><span class="si">}</span>
sh

<span class="c1"># 将表达式从右到左进行匹配，删除匹配的部分，同样可以使用通配符</span>
$ <span class="nb">echo</span> <span class="si">${</span><span class="nv">var</span><span class="p">%.*</span><span class="si">}</span>
file.name

<span class="c1"># 从右到左进行匹配的贪婪模式</span>
$ <span class="nb">echo</span> <span class="si">${</span><span class="nv">var</span><span class="p">%%.*</span><span class="si">}</span>
file
</code></pre></div><p>使用时需要注意 <code>#</code> 和 <code>%</code> 必须是从左或从右的完整匹配，或者是方向一致的通配符匹配才能正确删除字符。</p>
<p>关于这两个定义符的记忆，我建议直接看键盘， <code>#</code> 在 <code>$</code> 左边， <code>%</code> 在 <code>$</code> 右边，把它们指向 <code>$</code> 则暗合它们的开始匹配方向。</p>
<h2 id="awk内置函数split">awk内置函数split()</h2>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash"><span class="cp">#!/bin/bash
</span><span class="cp"></span><span class="c1"># awk 内置函数 split() 的用法：</span>

<span class="c1"># awk: split(string_to_split,array,IFS)</span>
<span class="c1"># 第一个参数是想要进行分割的字符串</span>
<span class="c1"># 第二个参数是分割完成后的变量</span>
<span class="c1"># 第三个参数用来指定分割符</span>

<span class="c1"># 实例</span>
split<span class="o">(</span><span class="s2">&#34;A;B;C;D&#34;</span>,array,<span class="s1">&#39;;&#39;</span><span class="o">)</span>
<span class="c1"># 执行完成后，array=[&#39;A&#39;,&#39;B&#39;,&#39;C&#39;,&#39;D&#39;]</span>
<span class="c1"># 值得注意的是 array 是 awk 的内部变量</span>
</code></pre></div><h2 id="awk导入外部数据">awk导入外部数据</h2>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash"><span class="cp">#!/bin/bash
</span><span class="cp"></span><span class="c1"># awk 可以导入外部数据，通常会用来导入 shell 变量进行进一步处理</span>
<span class="c1"># 灵活利用导入可以实现多样的数据处理</span>

<span class="c1"># 导入字符串并生成关联数组：</span>
<span class="nb">echo</span> <span class="s1">&#39;begin&#39;</span> <span class="p">|</span> awk -v <span class="nv">foreign</span><span class="o">=</span><span class="s1">&#39;1#A#2#B#3#C&#39;</span> <span class="se">\
</span><span class="se"></span><span class="s1">&#39;BEGIN{
</span><span class="s1">    split(foreign, dict, &#34;#&#34;);
</span><span class="s1">    for(i=1;i&lt;=length(dict);i+=2){
</span><span class="s1">        result[dict[i]]=dict[i+1]
</span><span class="s1">    }
</span><span class="s1">}
</span><span class="s1">{
</span><span class="s1">    for (i in result){
</span><span class="s1">        print result[i];
</span><span class="s1">    }
</span><span class="s1">}&#39;</span>

<span class="c1"># -v 可以导入外部数据为 awk 内部变量</span>
<span class="c1"># 这个例子将字符串 &#39;1#A#2#B#3#C&#39; 转换为字典 ([1]=A [2]=B [3]=C)</span>
</code></pre></div><h2 id="简单的循环用例">简单的循环用例</h2>
<p>在 Linux 中经常需要批量执行命令，需要一些限制避免占用大量资源，下面提供一些简单的循环用例。</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash"><span class="cp">#!/bin/bash
</span><span class="cp"></span><span class="c1"># 限制同一时间内循环的进程数量</span>

<span class="c1"># 总运行次数，数据源存放在 file 中</span>
<span class="nv">number</span><span class="o">=</span><span class="k">$(</span>cat file <span class="p">|</span> wc -l<span class="k">)</span> 
<span class="c1"># 单次并发进程数量控制</span>
<span class="nv">size</span><span class="o">=</span><span class="m">20</span>

<span class="nv">begin</span><span class="o">=</span><span class="m">1</span>
<span class="nv">end</span><span class="o">=</span><span class="nv">$size</span>

<span class="k">until</span> <span class="o">[</span> <span class="nv">$begin</span> -gt <span class="s2">&#34;</span><span class="nv">$number</span><span class="s2">&#34;</span> <span class="o">]</span>
<span class="k">do</span>
    <span class="k">for</span> i in <span class="k">$(</span>sed -n <span class="s2">&#34;</span><span class="nv">$begin</span><span class="s2">&#34;</span>,<span class="s2">&#34;</span><span class="nv">$end</span><span class="s2">&#34;</span>p file<span class="k">)</span>
    <span class="k">do</span>
    <span class="o">{</span>
        <span class="c1"># 主循环体，数据取自于 file</span>
    <span class="o">}</span><span class="p">&amp;</span>
    <span class="k">done</span> 

    <span class="nv">begin</span><span class="o">=</span><span class="k">$(</span> expr <span class="nv">$end</span> + <span class="m">1</span> <span class="k">)</span>
    <span class="nv">end</span><span class="o">=</span><span class="k">$(</span> expr <span class="nv">$end</span> + <span class="nv">$size</span> <span class="k">)</span>
    <span class="nb">wait</span>
    <span class="c1"># 单次并发会在这里阻塞，直到所有进程结束</span>
    <span class="c1"># 所以这个用例需要在循环体中加入超时控制</span>
<span class="k">done</span>


<span class="c1"># 循环读取文件内容</span>
<span class="c1"># 文件内容为多行数据，每行数据格式为 X Y Z</span>
<span class="k">while</span> <span class="nb">read</span> A B C
<span class="k">do</span>
    <span class="nb">echo</span> <span class="nv">$A</span>,<span class="nv">$B</span>,<span class="nv">$C</span>
<span class="k">done</span> &lt; file
</code></pre></div><h2 id="使用rpm进行软件包操作">使用rpm进行软件包操作</h2>
<p>rpm 是红帽软件包工具，是红帽系发行版使用的基本软件管理工具。除了安装卸载软件，它可以提供一些额外的功能。</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash"><span class="c1"># 直接安装已有的 rpm 包</span>
$ rpm -ivh package.rpm  
<span class="c1"># -i 用来表示安装</span>
<span class="c1"># -v 用来显示详细信息</span>
<span class="c1"># -h 用来显示安装进度</span>

<span class="c1"># 卸载已有软件</span>
$ rpm -evh package
<span class="c1"># -e 用来表示卸载</span>

<span class="c1"># 升级已有软件</span>
$ rpm -Uvh package.rpm
<span class="c1"># -U 用来表示升级软件，这个选项会保留原有配置文件</span>

<span class="c1"># 查询软件是否安装</span>
$ rpm -qa <span class="p">|</span> grep package
<span class="c1"># 这是我个人常用的查询方法，用来查询所有已经安装的软件然后再抓取需要的信息</span>

<span class="c1"># 查看软件安装的路径和文件位置</span>
$ rpm -ql package.rpm

<span class="c1"># 查询目标文件是由哪个软件所安装</span>
$ rpm -qf filename
</code></pre></div><h2 id="使用yum下载rpm包">使用yum下载rpm包</h2>
<p>有时候会有下载 rpm 包的需求，可以通过 yum 实现。</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">$ yum install package --downloadonly --downloaddir<span class="o">=</span>/your/dir
<span class="c1"># 可以只下载 rpm 包而不进行安装</span>
<span class="c1"># 不指定下载目录，则下载后文件保存在 /var/cache/yum/ 下的子目录中</span>
<span class="c1"># 如果 --downloadonly 运行失败，可能需要自行安装这个插件</span>
</code></pre></div><h2 id="配置yum源">配置yum源</h2>
<p>yum 是 Fedora 和 RedHat 以及 SUSE 中使用的软件包管理器，它的使用比直接使用 rpm 更加方便简单。</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash"><span class="c1"># yum 的全局配置</span>
$ cat /etc/yum.conf 
<span class="o">[</span>main<span class="o">]</span>
<span class="nv">cachedir</span><span class="o">=</span>/var/cache/yum/<span class="nv">$basearch</span>/<span class="nv">$releasever</span>  <span class="c1"># 指定缓存软件包和依赖信息的目录</span>
<span class="nv">keepcache</span><span class="o">=</span><span class="m">0</span>  <span class="c1"># 指定缓存是否会在使用后保留</span>
<span class="nv">debuglevel</span><span class="o">=</span><span class="m">2</span>  <span class="c1"># 指定日志信息的详细级别</span>
<span class="nv">logfile</span><span class="o">=</span>/var/log/yum.log  <span class="c1"># 指定生成日志的位置</span>
<span class="nv">exactarch</span><span class="o">=</span><span class="m">1</span>  <span class="c1"># 指定是否使用单一架构的软件包</span>
<span class="nv">obsoletes</span><span class="o">=</span><span class="m">1</span>  <span class="c1"># 指定是否允许更新比较陈旧的软件包</span>
<span class="nv">gpgcheck</span><span class="o">=</span><span class="m">1</span>  <span class="c1"># 指定进行安装包签名检查</span>
<span class="nv">plugins</span><span class="o">=</span><span class="m">1</span>  <span class="c1"># 指定是否可以使用插件</span>
<span class="nv">installonly_limit</span><span class="o">=</span><span class="m">5</span>  <span class="c1"># 指定允许保存的内核软件包数量</span>
<span class="nv">bugtracker_url</span><span class="o">=</span>http://bugs.centos.org/set_project.php?project_id<span class="o">=</span>23<span class="p">&amp;</span><span class="nv">ref</span><span class="o">=</span>http://bugs.centos.org/bug_report_page.php?category<span class="o">=</span>yum
<span class="nv">distroverpkg</span><span class="o">=</span>centos-release  <span class="c1">#指定用来获取系统的发行版信息的软件</span>
</code></pre></div><p>全局配置基本上不用做修改，更多情况下只需要自行添加需要的镜像源。</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash"><span class="c1"># 参考具体的镜像源配置</span>
$ <span class="nb">cd</span> /etc/yum.repos.d
$ cat CentOS-Base.repo 
<span class="o">[</span>base<span class="o">]</span>
<span class="nv">name</span><span class="o">=</span>CentOS-<span class="nv">$releasever</span> - Base
<span class="nv">mirrorlist</span><span class="o">=</span>http://mirrorlist.centos.org/?release<span class="o">=</span><span class="nv">$releasever</span><span class="p">&amp;</span><span class="nv">arch</span><span class="o">=</span><span class="nv">$basearch</span><span class="p">&amp;</span><span class="nv">repo</span><span class="o">=</span>os<span class="p">&amp;</span><span class="nv">infra</span><span class="o">=</span><span class="nv">$infra</span>
<span class="c1">#baseurl=http://mirror.centos.org/centos/$releasever/os/$basearch/</span>
<span class="nv">gpgcheck</span><span class="o">=</span><span class="m">1</span>
<span class="nv">gpgkey</span><span class="o">=</span>file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-6

<span class="c1">#rerpmleased updates </span>
<span class="o">[</span>updates<span class="o">]</span>
<span class="nv">name</span><span class="o">=</span>CentOS-<span class="nv">$releasever</span> - Updates
<span class="nv">mirrorlist</span><span class="o">=</span>http://mirrorlist.centos.org/?release<span class="o">=</span><span class="nv">$releasever</span><span class="p">&amp;</span><span class="nv">arch</span><span class="o">=</span><span class="nv">$basearch</span><span class="p">&amp;</span><span class="nv">repo</span><span class="o">=</span>updates<span class="p">&amp;</span><span class="nv">infra</span><span class="o">=</span><span class="nv">$infra</span>
<span class="c1">#baseurl=http://mirror.centos.org/centos/$releasever/updates/$basearch/</span>
<span class="nv">gpgcheck</span><span class="o">=</span><span class="m">1</span>
<span class="nv">gpgkey</span><span class="o">=</span>file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-6

<span class="c1">#additional packages that may be useful</span>
<span class="o">[</span>extras<span class="o">]</span>
<span class="nv">name</span><span class="o">=</span>CentOS-<span class="nv">$releasever</span> - Extras
<span class="nv">mirrorlist</span><span class="o">=</span>http://mirrorlist.centos.org/?release<span class="o">=</span><span class="nv">$releasever</span><span class="p">&amp;</span><span class="nv">arch</span><span class="o">=</span><span class="nv">$basearch</span><span class="p">&amp;</span><span class="nv">repo</span><span class="o">=</span>extras<span class="p">&amp;</span><span class="nv">infra</span><span class="o">=</span><span class="nv">$infra</span>
<span class="c1">#baseurl=http://mirror.centos.org/centos/$releasever/extras/$basearch/</span>
<span class="nv">gpgcheck</span><span class="o">=</span><span class="m">1</span>
<span class="nv">gpgkey</span><span class="o">=</span>file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-6
</code></pre></div><p>在 /etc/yum.repos.d 目录中以 repo 结尾的文件会被识别为镜像源的配置文件，一个镜像源配置文件内可以配置多个 Repository ，每个 Repository 的唯一标识用 [xxxx] 表示，它们的具体内容如下：</p>
<ul>
<li>
<p>name 是对 Repository 的描述。</p>
</li>
<li>
<p>enable 规定对应 Repository 是否启用，可以使用这个选项屏蔽 Repository 。</p>
</li>
<li>
<p>mirrorlist 和 baseurl 规定了 Repository 的地址。</p>
<ul>
<li>baseurl 是指向 Repository 的 repodata 目录的地址，里面存放了软件包和他们的依赖关系。它可以指向本地和云端，本地一般以 file:// 来指定，云端可以使用 http，ftp 等工具。</li>
<li>mirrorlist 是 baseurl 的一种集合形式，可以说 mirrorlist 指向的是一系列的 baseurl ，配合 fastestmirror 插件能找到响应速度最快的 Repository 。</li>
</ul>
</li>
<li>
<p>gpgcheck 和 gpgkey 是对软件包的签名检查的相关选项。</p>
<ul>
<li>gpgcheck 规定是否进行签名检查。</li>
<li>gpgkey 指定了签名检查的合法签名数据源。</li>
</ul>
</li>
</ul>
<p>现有国内网络环境下，原始镜像速度很慢，可以使用公开的国内镜像源，它们大部分提供了相关的配置方法，如果是自建的镜像源，那么至少需要自行配置 name 和 baseurl 才能正常使用。</p>
<h2 id="使用cpio打开rpm文件">使用cpio打开rpm文件</h2>
<p>rpm 包可以视为一个特殊的归档文件，如果需要提取这个档案中的内容，一般通过 rpm2cpio 和 cpio 去实现。</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash"><span class="c1"># 常用的实例命令</span>
$ rpm2cpio package.rpm <span class="p">|</span> cpio -divm

<span class="c1"># 以下是 cpio 比较重要的参数</span>
<span class="c1"># -i/--extract 展开文件</span>
<span class="c1"># -o/--create 生成文件</span>
<span class="c1"># -v/--verbose 显示详细过程</span>
<span class="c1"># -d/--make-directories 在需要时建立目录</span>
<span class="c1"># -m/--preserve-modification-time 保留更改时间。</span>
</code></pre></div><h2 id="更新文件到initramfs镜像中">更新文件到initramfs镜像中</h2>
<p>在 Linux 系统中，我们一般可以在 <code>/boot</code> 目录中找到 initramfs 镜像文件，它们是引导系统的必要组件。如果需要使用到的系统命令没有编译到镜像中，可以使用 dracut 命令进行镜像更新。</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash"><span class="c1"># 使用 file 命令可以看到 CentOS 7.4 的 initramfs 镜像是由 gunzip 压缩的文件</span>
<span class="c1"># initramfs-3.10.0-693.el7.x86_64.img: gzip compressed data, from Unix, </span>
<span class="c1"># last modified: Sat Mar 16 15:51:25 2019, max compression</span>

<span class="c1"># 以常规思路去处理这个文件</span>
<span class="c1"># 首先需要更改命名后缀，否则 gunzip 无法识别</span>
$ cp initramfs-3.10.0-693.el7.x86_64.img /tmp/initramfs-3.10.0-693.el7.x86_64.img.gz
<span class="c1"># 使用 gunzip 解压</span>
$ gunzip -d initramfs-3.10.0-693.el7.x86_64.img.gz
<span class="c1"># 使用 file 命令可以看到解压后是 cpio 归档文件</span>
<span class="c1"># initramfs-3.10.0-693.el7.x86_64.img: ASCII cpio archive (SVR4 with no CRC)</span>
<span class="c1"># 进一步解包归档文件</span>
$ cpio -divm &lt; initramfs-3.10.0-693.el7.x86_64.img
<span class="c1"># 到这一步可以完全提取出镜像内的文件</span>

<span class="c1"># 使用专用命令去查看镜像信息，比较推荐使用这种用法</span>
$ lsinitrd /tmp/initramfs-3.10.0-693.el7.x86_64.img
<span class="c1"># 可以看到基础的镜像信息和镜像内的具体文件信息</span>

<span class="c1"># 更新系统命令文件到 initramfs 中</span>
$ dracut -v -I <span class="s1">&#39;/usr/sbin/xfsdump /usr/sbin/xfsrestore&#39;</span> -f <span class="o">[</span>initramfs.img<span class="o">]</span>
<span class="c1"># -v 显示详细过程</span>
<span class="c1"># -I 需要添加到镜像中的文件列表，不同文件以空格隔开</span>
<span class="c1"># -f 强制覆写原有镜像，这个选项一般放在最后或者镜像文件名之前，否则可能会报错</span>
<span class="c1"># 这里可以省略镜像名称，会默认使用 /boot/initramfs-kernel_version.img</span>
<span class="c1"># 有需要可以在命令最后加上镜像文件名</span>

<span class="c1"># 这里添加了 xfs 文件系统的备份和还原命令，它们是需要额外安装的</span>
<span class="c1"># 执行 dracut 完成后可以使用 lsinitrd 检查是否成功</span>
</code></pre></div></article>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>
</div>
<script>
 
 
 
 window.onload = function () {
   const header = document.getElementById('post-header');
   const headerHeight = header.offsetHeight;
   
   document.documentElement.style.scrollPaddingTop = headerHeight + 10 + "px";
 }

 const tocToggleButton = document.getElementById("toc-toggle");

 const tippyInstance = tippy('#toc-toggle', {
  trigger: 'click',
  content: '<div id="table-of-contents">\u003cnav id=\u0022TableOfContents\u0022\u003e\n  \u003cul\u003e\n    \u003cli\u003e\u003ca href=\u0022#linux的归档和压缩命令\u0022\u003eLinux的归档和压缩命令\u003c\/a\u003e\u003c\/li\u003e\n    \u003cli\u003e\u003ca href=\u0022#硬盘分区和格式化\u0022\u003e硬盘分区和格式化\u003c\/a\u003e\u003c\/li\u003e\n    \u003cli\u003e\u003ca href=\u0022#curl的基本使用\u0022\u003ecurl的基本使用\u003c\/a\u003e\u003c\/li\u003e\n    \u003cli\u003e\u003ca href=\u0022#curl结合bash变量使用\u0022\u003ecurl结合bash变量使用\u003c\/a\u003e\u003c\/li\u003e\n    \u003cli\u003e\u003ca href=\u0022#使用sed快速去除无用字符\u0022\u003e使用sed快速去除无用字符\u003c\/a\u003e\u003c\/li\u003e\n    \u003cli\u003e\u003ca href=\u0022#在shell中使用数组\u0022\u003e在shell中使用数组\u003c\/a\u003e\u003c\/li\u003e\n    \u003cli\u003e\u003ca href=\u0022#bash变量操作符\u0022\u003ebash变量操作符\u003c\/a\u003e\u003c\/li\u003e\n    \u003cli\u003e\u003ca href=\u0022#awk内置函数split\u0022\u003eawk内置函数split()\u003c\/a\u003e\u003c\/li\u003e\n    \u003cli\u003e\u003ca href=\u0022#awk导入外部数据\u0022\u003eawk导入外部数据\u003c\/a\u003e\u003c\/li\u003e\n    \u003cli\u003e\u003ca href=\u0022#简单的循环用例\u0022\u003e简单的循环用例\u003c\/a\u003e\u003c\/li\u003e\n    \u003cli\u003e\u003ca href=\u0022#使用rpm进行软件包操作\u0022\u003e使用rpm进行软件包操作\u003c\/a\u003e\u003c\/li\u003e\n    \u003cli\u003e\u003ca href=\u0022#使用yum下载rpm包\u0022\u003e使用yum下载rpm包\u003c\/a\u003e\u003c\/li\u003e\n    \u003cli\u003e\u003ca href=\u0022#配置yum源\u0022\u003e配置yum源\u003c\/a\u003e\u003c\/li\u003e\n    \u003cli\u003e\u003ca href=\u0022#使用cpio打开rpm文件\u0022\u003e使用cpio打开rpm文件\u003c\/a\u003e\u003c\/li\u003e\n    \u003cli\u003e\u003ca href=\u0022#更新文件到initramfs镜像中\u0022\u003e更新文件到initramfs镜像中\u003c\/a\u003e\u003c\/li\u003e\n  \u003c\/ul\u003e\n\u003c\/nav\u003e</div>',
  allowHTML: true,
  placement: 'bottom-start',
  interactive: true,
  arrow: false,
  maxWidth: "none",
  onHide: function () { tocToggleButton.classList.remove("hover"); },
  onShow: function () { tocToggleButton.classList.add("hover"); },
  onShown: function () {
    selectTableOfContentsOption();

    if (window.hasSetupTableOfContentsListeners) {
      return;
    }

    const tableOfContents = document.getElementById("table-of-contents");
    tableOfContents.addEventListener('click', function () {
      
      tippyInstance[0].hide();
    });

    window.hasSetupTableOfContentsListeners = true;
  }
 });

 function selectTableOfContentsOption () {
   const optionSelectedClass = 'table-of-contents-option-selected';

   const tableOfContentsOptions = document.querySelectorAll("#table-of-contents > nav > ul li");

   for (const option of tableOfContentsOptions) {
     

     const [child] = option.children;
     if (child.tagName.toLowerCase() !== 'a') {
       continue;
     }

     if (window.location.href === child.href) {
       child.classList.add(optionSelectedClass);
     } else {
       child.classList.remove(optionSelectedClass);
     }
   }
 }

 window.onhashchange = selectTableOfContentsOption;
</script>


  <div class="footer container-xl width-full p-responsive">
  <div
    class="position-relative d-flex flex-row-reverse flex-lg-row flex-wrap flex-lg-nowrap flex-justify-center flex-lg-justify-between flex-sm-items-center pt-6 pb-2 mt-6 f6 text-gray border-top border-gray-light ">
    <a aria-label="Homepage" title="GitHub" class="footer-octicon d-none d-lg-block mr-lg-4" href="https://yuweizzz.github.io">
      <svg height="24" class="octicon octicon-mark-github" viewBox="0 0 16 16" version="1.1" width="24">
        <path fill-rule="evenodd"
          d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z">
        </path>
      </svg>
    </a>
    <ul class="list-style-none d-flex flex-wrap col-12 flex-justify-center flex-lg-justify-between mb-2 mb-lg-0">
      
      <li class="mr-3 mr-lg-0">Theme by <a href='https://github.com/MeiK2333/github-style'>github-style</a></li>
      
    </ul>
  </div>
  <div class="d-flex flex-justify-center pb-6">
    <span class="f6 text-gray-light"></span>
  </div>


</div>
</body>

<script type="application/javascript" src="https://yuweizzz.github.io/js/github-style.js"></script>


<script src="https://cubism.live2d.com/sdk-web/cubismcore/live2dcubismcore.min.js"></script>
<script type="text/javascript" src="https://yuweizzz.github.io/js/CustomLive2D.js"></script>


</html>