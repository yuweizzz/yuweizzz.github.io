<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <script type="application/javascript" src='https://yuweizzz.github.io/js/theme-mode.js'></script>
    <link rel="stylesheet" href='https://yuweizzz.github.io/css/frameworks.min.css' />
    <link rel="stylesheet" href='https://yuweizzz.github.io/css/github.min.css' />
    <link rel="stylesheet" href='https://yuweizzz.github.io/css/github-style.css' />
    <link rel="stylesheet" href='https://yuweizzz.github.io/css/light.css' />
    <link rel="stylesheet" href='https://yuweizzz.github.io/css/dark.css' />
    <link rel="stylesheet" href='https://yuweizzz.github.io/css/syntax.css' />
    <title>安装 Linux 图形界面 - Wei&#39;s blog</title>
    
    <link rel="icon" type="image/x-icon" href='/images/github.png'>
    
    <meta name="theme-color" content="#1e2327">

    
    <meta name="description"
  content="这篇笔记主要介绍如何为 CentOS 安装图形界面。
" />
<meta name="keywords"
  content='blog, google analytics' />
<meta name="robots" content="noodp" />
<link rel="canonical" href="https://yuweizzz.github.io/post/install_gui_in_linux/" />


<meta name="twitter:card" content="summary" />
<meta name="twitter:title" content="安装 Linux 图形界面 - Wei&#39;s blog" />
<meta name="twitter:description"
  content="这篇笔记主要介绍如何为 CentOS 安装图形界面。
" />
<meta name="twitter:site" content="https://yuweizzz.github.io" />
<meta name="twitter:creator" content="" />
<meta name="twitter:image"
  content="https://yuweizzz.github.io">


<meta property="og:type" content="article" />
<meta property="og:title" content="安装 Linux 图形界面 - Wei&#39;s blog">
<meta property="og:description"
  content="这篇笔记主要介绍如何为 CentOS 安装图形界面。
" />
<meta property="og:url" content="https://yuweizzz.github.io/post/install_gui_in_linux/" />
<meta property="og:site_name" content="安装 Linux 图形界面" />
<meta property="og:image"
  content="https://yuweizzz.github.io">
<meta property="og:image:width" content="2048">
<meta property="og:image:height" content="1024">

<meta property="article:published_time" content="2021-03-30 21:00:00 &#43;0000 UTC" />










</head>

<body>
  <div style="position: relative">
  <header class="Header js-details-container Details px-3 px-md-4 px-lg-5 flex-wrap flex-md-nowrap open Details--on">
    <div class="Header-item mobile-none" style="margin-top: -4px; margin-bottom: -4px;">
      <a class="Header-link" href="https://yuweizzz.github.io">
        <svg class="octicon" height="32" viewBox="0 0 16 16" version="1.1" width="32">
          <path fill-rule="evenodd"
            d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z">
          </path>
        </svg>
      </a>
    </div>
    <div class="Header-item d-md-none">
      <button class="Header-link btn-link js-details-target" type="button"
        onclick="document.querySelector('#header-search').style.display = document.querySelector('#header-search').style.display == 'none'? 'block': 'none'">
        <svg height="24" class="octicon octicon-three-bars" viewBox="0 0 16 16" version="1.1" width="24">
          <path fill-rule="evenodd"
            d="M1 2.75A.75.75 0 011.75 2h12.5a.75.75 0 110 1.5H1.75A.75.75 0 011 2.75zm0 5A.75.75 0 011.75 7h12.5a.75.75 0 110 1.5H1.75A.75.75 0 011 7.75zM1.75 12a.75.75 0 100 1.5h12.5a.75.75 0 100-1.5H1.75z">
          </path>
        </svg>
      </button>
    </div>
    <div style="display: none;" id="header-search"
      class="Header-item Header-item--full flex-column flex-md-row width-full flex-order-2 flex-md-order-none mr-0 mr-md-3 mt-3 mt-md-0 Details-content--hidden-not-important d-md-flex">
      <div
        class="Header-search header-search flex-auto js-site-search position-relative flex-self-stretch flex-md-self-auto mb-3 mb-md-0 mr-0 mr-md-3 scoped-search site-scoped-search js-jump-to">
        <div class="position-relative">
          <form target="_blank" action="https://www.google.com/search" accept-charset="UTF-8" method="get"
            autocomplete="off">
            <label
              class="Header-search-label form-control input-sm header-search-wrapper p-0 js-chromeless-input-container header-search-wrapper-jump-to position-relative d-flex flex-justify-between flex-items-center">
              <input type="text"
                class="Header-search-input form-control input-sm header-search-input jump-to-field js-jump-to-field js-site-search-focus js-site-search-field is-clearable"
                name="q" value="" placeholder="Search" autocomplete="off">
              <input type="hidden" name="q" value="site:https://yuweizzz.github.io">
            </label>
          </form>
        </div>
      </div>
    </div>

    <div class="Header-item Header-item--full flex-justify-center d-md-none position-relative">
      <a class="Header-link " href="https://yuweizzz.github.io">
        <svg class="octicon octicon-mark-github v-align-middle" height="32" viewBox="0 0 16 16" version="1.1"
          width="32">
          <path fill-rule="evenodd"
            d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z">
          </path>
        </svg>
      </a>
    </div>
    <div class="Header-item" style="margin-right: 0;">
      <a href="javascript:void(0)" class="Header-link no-select" onclick="switchTheme()">
        <svg style="fill: var(--color-profile-color-modes-toggle-moon);" class="no-select" viewBox="0 0 16 16"
          version="1.1" width="16" height="16">
          <path fill-rule="evenodd" clip-rule="evenodd"
            d="M4.52208 7.71754C7.5782 7.71754 10.0557 5.24006 10.0557 2.18394C10.0557 1.93498 10.0392 1.68986 10.0074 1.44961C9.95801 1.07727 10.3495 0.771159 10.6474 0.99992C12.1153 2.12716 13.0615 3.89999 13.0615 5.89383C13.0615 9.29958 10.3006 12.0605 6.89485 12.0605C3.95334 12.0605 1.49286 10.001 0.876728 7.24527C0.794841 6.87902 1.23668 6.65289 1.55321 6.85451C2.41106 7.40095 3.4296 7.71754 4.52208 7.71754Z">
          </path>
        </svg>
      </a>
    </div>
  </header>
</div>
  
<script src="https://unpkg.com/@popperjs/core@2"></script>
<script src="https://unpkg.com/tippy.js@6"></script>
<div>
  <main>
    <div class="gisthead pagehead bg-gray-light pb-0 pt-3 mb-4">
      <div class="px-0">
        <div class="mb-3 d-flex px-3 px-md-3 px-lg-5">
          <div class="flex-auto min-width-0 width-fit mr-3">
            <div class="d-flex">
              <div class="d-none d-md-block">
                <a class="avatar mr-2 flex-shrink-0" href="https://yuweizzz.github.io">
                  <img class=" avatar-user"
                    src="https://yuweizzz.github.io/images/avatar.png"
                    width="32" height="32"></a>
              </div>
              <div class="d-flex flex-column">
                <h1 class="break-word f3 text-normal mb-md-0 mb-1">
                  <span class="author">
                    <a href="https://yuweizzz.github.io">Wei</a></span><span
                    class="path-divider">/</span><strong class="css-truncate-target mr-1" style="max-width: 410px"><a
                      href="https://yuweizzz.github.io/post/install_gui_in_linux/">安装 Linux 图形界面</a></strong>
                </h1>
                <div class="note m-0">
                  Created <relative-time datetime="Tue, 30 Mar 2021 21:00:00 &#43;0000"
                    class="no-wrap">
                    Tue, 30 Mar 2021 21:00:00 &#43;0000</relative-time>

                  
                  <span class="file-info-divider"></span>
                  Modified <relative-time datetime="Mon, 03 Jan 2022 10:02:27 &#43;0000"
                    class="no-wrap">
                    Mon, 03 Jan 2022 10:02:27 &#43;0000</relative-time>
                  
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="container-lg px-3 new-discussion-timeline">
      <div class="repository-content gist-content">
        <div>
          <div class="js-gist-file-update-container js-task-list-container file-box">
            <div id="file-pytest" class="file my-2">
              <div id="post-header" class="file-header d-flex flex-md-items-center flex-items-start sticky-header">
                <div class="file-info d-flex flex-md-items-center flex-items-start flex-order-1 flex-auto">
                  <div class="text-mono f6 flex-auto pr-3 flex-order-2 flex-md-order-1 mt-2 mt-md-0">
                    
                    <summary id="toc-toggle" class="btn btn-octicon m-0 mr-2 p-2" aria-haspopup="menu" aria-label="Table of Contents" role="button">
                      <svg aria-hidden="true" viewBox="0 0 16 16" height="16" width="16" class="octicon octicon-list-unordered">
                        <path fill-rule="evenodd" d="M2 4a1 1 0 100-2 1 1 0 000 2zm3.75-1.5a.75.75 0 000 1.5h8.5a.75.75 0 000-1.5h-8.5zm0 5a.75.75 0 000 1.5h8.5a.75.75 0 000-1.5h-8.5zm0 5a.75.75 0 000 1.5h8.5a.75.75 0 000-1.5h-8.5zM3 8a1 1 0 11-2 0 1 1 0 012 0zm-1 6a1 1 0 100-2 1 1 0 000 2z"></path>
                      </svg>
                    </summary>
                          3741 Words
                    

                  </div>
                  <div class="file-actions flex-order-2 pt-0">
                    
                    
                    <a class="muted-link mr-3" href="/tags/linux">
                      <svg class="octicon octicon-tag" viewBox="0 0 16 16" version="1.1" width="16" height="16">
                        <path fill-rule="evenodd"
                          d="M2.5 7.775V2.75a.25.25 0 01.25-.25h5.025a.25.25 0 01.177.073l6.25 6.25a.25.25 0 010 .354l-5.025 5.025a.25.25 0 01-.354 0l-6.25-6.25a.25.25 0 01-.073-.177zm-1.5 0V2.75C1 1.784 1.784 1 2.75 1h5.025c.464 0 .91.184 1.238.513l6.25 6.25a1.75 1.75 0 010 2.474l-5.026 5.026a1.75 1.75 0 01-2.474 0l-6.25-6.25A1.75 1.75 0 011 7.775zM6 5a1 1 0 100 2 1 1 0 000-2z">
                        </path>
                      </svg>
                      Linux
                    </a>
                    
                    
                  </div>
                </div>
              </div>


              <div class="Box-body px-5 pb-5">
                <article class="markdown-body entry-content container-lg"><p>这篇笔记主要介绍如何为 CentOS 安装图形界面。</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">
                                       <span class="o">(</span>@@<span class="o">)</span> <span class="o">(</span>  <span class="o">)</span> <span class="o">(</span>@<span class="o">)</span>  <span class="o">(</span> <span class="o">)</span>  @@    <span class="o">()</span>    @     O     @     O      @
                                  <span class="o">(</span>   <span class="o">)</span>
                              <span class="o">(</span>@@@@<span class="o">)</span>
                           <span class="o">(</span>    <span class="o">)</span>

                         <span class="o">(</span>@@@<span class="o">)</span>
                       <span class="o">====</span>        ________                ___________
                   _D _<span class="p">|</span>  <span class="p">|</span>_______/        <span class="se">\_</span>_I_I_____<span class="o">===</span>__<span class="p">|</span>_________<span class="p">|</span>
                    <span class="p">|</span><span class="o">(</span>_<span class="o">)</span>---  <span class="p">|</span>   H<span class="se">\_</span>_______/ <span class="p">|</span>   <span class="p">|</span>        <span class="o">=</span><span class="p">|</span>___ ___<span class="p">|</span>      _________________
                    /     <span class="p">|</span>  <span class="p">|</span>   H  <span class="p">|</span>  <span class="p">|</span>     <span class="p">|</span>   <span class="p">|</span>         <span class="o">||</span>_<span class="p">|</span> <span class="p">|</span>_<span class="o">||</span>     _<span class="p">|</span>                <span class="se">\_</span>____A
                   <span class="p">|</span>      <span class="p">|</span>  <span class="p">|</span>   H  <span class="p">|</span>__--------------------<span class="p">|</span> <span class="o">[</span>___<span class="o">]</span> <span class="p">|</span>   <span class="o">=</span><span class="p">|</span>                        <span class="p">|</span>
                   <span class="p">|</span> ________<span class="p">|</span>___H__/__<span class="p">|</span>_____/<span class="o">[][]</span>~<span class="se">\_</span>______<span class="p">|</span>       <span class="p">|</span>   -<span class="p">|</span>                        <span class="p">|</span>
                   <span class="p">|</span>/ <span class="p">|</span>   <span class="p">|</span>-----------I_____I <span class="o">[][]</span> <span class="o">[]</span>  D   <span class="p">|</span><span class="o">=======</span><span class="p">|</span>____<span class="p">|</span>________________________<span class="p">|</span>_
                 __/ <span class="o">=</span><span class="p">|</span> o <span class="p">|</span><span class="o">=</span>-~O<span class="o">=====</span><span class="nv">O</span><span class="o">=====</span><span class="nv">O</span><span class="o">=====</span>O<span class="se">\ </span>____Y___________<span class="p">|</span>__<span class="p">|</span>__________________________<span class="p">|</span>_
                  <span class="p">|</span>/-<span class="o">=</span><span class="p">|</span>___<span class="p">|</span><span class="o">=</span>    <span class="o">||</span>    <span class="o">||</span>    <span class="o">||</span>    <span class="p">|</span>_____/~<span class="se">\_</span>__/          <span class="p">|</span>_D__D__D_<span class="p">|</span>  <span class="p">|</span>_D__D__D_<span class="p">|</span>
                   <span class="se">\_</span>/      <span class="se">\_</span>_/  <span class="se">\_</span>_/  <span class="se">\_</span>_/  <span class="se">\_</span>_/      <span class="se">\_</span>/               <span class="se">\_</span>/   <span class="se">\_</span>/    <span class="se">\_</span>/   <span class="se">\_</span>/

</code></pre></div><h2 id="图形界面的运行原理">图形界面的运行原理</h2>
<p>Linux 各类发行版图形界面的理论支持就是大名鼎鼎的 X Window System ，它是基于 Server/Clinet 架构的一套复杂软件，主要的工作组件是 X Server 和 X Client 。</p>
<pre><code>#  X Window System 架构:

+----------+        +----------+        +----------+
| Hardware |&lt;------&gt;| X Server |&lt;------&gt;| X Client |
+----------+        +----------+        +----------+
</code></pre><p>X Window System 的两个主要组件的工作内容如下：</p>
<ul>
<li>X Server：和硬件层面对接，从输入设备(键盘，鼠标)获取输入数据并告知 Client ，在输出设备(显示器)上绘制从 Client 获取的绘图数据。</li>
<li>X Client：从 Server 获取到硬件的输入数据，处理它们得出对应的绘图数据返回给 Server 。</li>
</ul>
<p>X Server 是相对固定的一套软件，和硬件交互的主要是各类硬件驱动的使用和管理。</p>
<p>而 X Client 就十分地自由，它可以是浏览器，办公软件，播放器等等。一个 X Client 可以认为是图形界面中的一个软件窗口。</p>
<p>我们经常听到的 KDE ， GNOME ， Xfce 是特殊的 X Client 套件，通常认为是窗口管理器，因为它们可以统筹管理同一界面下的多个 X Client 。</p>
<p>所以如果要为一台机器安装带图形界面的 Linux 系统，我们会需要安装 X Window System 组件以提供 X Server ，然后安装 KDE 这一类特殊的 X Client 套件，组成一套可用的图形界面。</p>
<h2 id="传统serverclinet架构和x-window-system架构的区别">传统Server/Clinet架构和X Window System架构的区别</h2>
<h3 id="传统serverclinet架构">传统Server/Clinet架构</h3>
<p>在传统的 Server/Clinet 架构中，最经典应用应该是 HTTP 服务。</p>
<p>在 HTTP 服务中， Server 一般是运行在远端的 HTTP 服务器，比如 nginx 或者 Apache 。我们在 PC 端向 Server 发起请求， Server 在接受请求后响应并返回数据到 PC 端。</p>
<p>从使用者的视角来看， Client 很好理解，无疑就是自己使用的 PC 设备，而 Server 就是远端提供服务的设备。</p>
<h3 id="x-window-system架构">X Window System架构</h3>
<p>当一台 Linux 系统的机器运行图形界面时，它的 X Server 和 X Client 都会运行在自己的本地机器上，这种应用情况在传统的 Server/Clinet 架构中比较少。</p>
<p>此外还有一种情况就是和 HTTP 服务类似， X Server 和 X Client 不在同一台机器上运行，而是通过网络通信，但这种 X Window System 应用情况会比较少。</p>
<pre><code>#  运行在网络上的 X Window System 架构:


+----------+                                             +----------+
|  Input   |                                             |  Input   |
+----------+                                             +----------+
     |                                                        |
     |                 +---------------------+                |
     v                 |  remote workstation |                v
+----------+  Network  +----------+----------+  Network  +----------+ 
| X Server |&lt;---------&gt;| X Client | X Client |&lt;---------&gt;| X Server |
+----------+           +----------+----------+           +----------+
     |                 |     ...........     |                |
     |                 +---------------------+                |
     v                                                        v
+----------+                                             +----------+
|  Output  |                                             |  Output  |
+----------+                                             +----------+
</code></pre><p>在 X Window System 架构运行在网络上时， X Server 和 X Client 会通过网络传输数据。虽然 X Server 的服务对象依旧是 X Client ，但这时它们是分开在网络的两端的，站在使用者的角度上，远端不再是常见的 Server ，反而是各类 X Client ，它们会去完成软件的数据计算工作。而我们本地设备则成为了 X Server ，管理着本地硬件并且承担绘制图形的工作。</p>
<p>这就是 X Window System 比较特殊的地方，但它本质上还是遵循着 Server 为 Client 提供服务的原则。</p>
<h2 id="使用-centos-图形界面">使用 CentOS 图形界面</h2>
<h3 id="安装本地图形界面">安装本地图形界面</h3>
<p>在市面上的不同 Linux 发行版中，在个人用户中比较受欢迎的是 Ubuntu ，但是我个人习惯使用的 Linux 发行版是 CentOS ，它更多地用于服务器的场景，而且一般不会安装图形界面，所以需要额外去探究一下。</p>
<p>对于发行版的选择，我认为贴近自己的工作场景是比较重要的参考。 CentOS 是稳定的服务器系统，而 Ubuntu 使用的内核比较新，图形界面的支持比较丰富。此外还可以 Debian 或者 Fedora 这些发行版可供选择。</p>
<p>我个人推荐是 CentOS 或 Ubuntu 中任意一款，因为这些发行版的用户相对较多，各类支持和解决方案也相应地比其他发行版来的多。</p>
<p>如前面所提到的，我们需要安装 Server 和 Client 两个组件。</p>
<p>CentOS 如果没有安装过图形界面，需要先安装 X Window System ，它提供了 X Server 的功能。</p>
<p>还需要安装 X Client ，可以选择只安装个人需要的 X Clinet，但一般会都会安装主流的桌面套件提供完整的支持，我的个人选择的桌面套件是 xfce 。</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash"><span class="c1">#  前置的软件安装工作：</span>

$ yum group install <span class="s1">&#39;x window system&#39;</span> -y
$ yum group install xfce -y  <span class="c1"># 这里可选择其他套件：GNOME Desktop or KDE Plasma Workspaces</span>
<span class="c1"># 安装完成后，切换到图形界面的两种方式：</span>
$ init <span class="m">5</span>
$ systemctl isolate graphical.target

<span class="c1"># 安装完成后，可以设置默认启动环境为图形界面</span>
$ systemctl get-default  <span class="c1"># 默认应该为多用户界面 </span>
multi-user.target
$ systemctl set-default graphical.target
$ reboot  <span class="c1"># 修改设置后重启生效</span>
</code></pre></div><h3 id="运行时分析">运行时分析</h3>
<p>如果安装没有报错，我们在执行切换命令后就会自动切换到图形界面。</p>
<blockquote>
<p>在某些版本中，可能会出现无法立即切换图形的情况，解决办法一般是先切换为原来的运行等级，在终端界面会产生文本模式的会话，选择接受 licence 后再尝试切换。</p>
</blockquote>
<p>为了更好地了解运行的原理，我们可以抓取进程信息进行分析，看看服务是如何运行的。</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash"><span class="c1">#  切换图形界面后的进程信息：</span>

$ ps aux <span class="p">|</span> grep X
root       <span class="m">1002</span>  0.0  0.2 <span class="m">225840</span>  <span class="m">4812</span> ?        Ss   16:55   0:00 /usr/bin/abrt-watch-log -F Backtrace 
  /var/log/Xorg.0.log -- /usr/bin/abrt-dump-xorg -xD
root       <span class="m">1597</span>  0.5  2.4 <span class="m">340104</span> <span class="m">49876</span> tty1     Ssl+ 16:56   0:01 /usr/bin/X :0 -background none -noreset 
  -audit <span class="m">4</span> -verbose -auth /run/gdm/auth-for-gdm-VsIE6S/database 
  -seat seat0 -nolisten tcp vt1  <span class="c1"># X server 的进程详情</span>
root       <span class="m">2060</span>  0.0  0.0 <span class="m">112812</span>   <span class="m">948</span> pts/1    S+   17:00   0:00 grep --color<span class="o">=</span>auto X
</code></pre></div><p>如果我们已经启动了图形界面，那么这台机器上必然已有一个 X 进程，这时我们需要关注一个环境变量 DISPLAY ，它为所有的 X Client 提供 X Server 的通信地址。</p>
<p>这里有个地方比较有意思，如果在图形界面下的终端打印这个变量，可以看到格式为 hostname:displaynumber.screennumber 的值，但是如果你切换到命令行界面并打印这个变量，会发现结果为空。那是因为这个变量在命令行界面是无意义的，而它对图形界面运行的 Client 却是不能缺少的，如果没有它， Server 和 Client 之间就无法通信，所以新的 Client 都会继承这个环境变量。</p>
<p>关于 DISPLAY 这个环境变量，我们可以在 X Server 的文档中查到相关的信息：</p>
<ul>
<li>hostname 如果是为空，那么它默认会使用本地 X Server 中的最高效通信方式 Unix Socket ，实际使用中这个值经常留空。</li>
<li>displaynumber 用来界定显示器和输入设备的集合，用于区分不同的显示界面，是不能为空的。</li>
<li>screennumber 用来界定某个集合中不同的显示器，比如多显示器使用主副屏的情况。考虑到现实情况中，用户通常只有一个显示器， screennumber 留空则默认 0 。</li>
</ul>
<p>所以可以看到实际中的 DISPLAY 一般是类似于 :0 ， :1 ， :10 这样的值，系统默认启动的 X 进程 DISPLAY 就是 :0 ，符合前面所描述的使用习惯。此外 displaynumber 一般还会作为这个 X Server 监听的端口号偏移量。</p>
<p>X Server 的默认监听端口是 6000 ，如果是指定了 DISPLAY 的 X Server ，那么除了端口已被占用的情况，一般会在 6000 的 displaynumber 偏移端口上进行监听，当指定 DISPLAY 为 :1 会监听在 6001 端口，指定 DISPLAY 为 :10 会监听在 6010 端口，这个部分可以通过 netstat 查看系统的监听情况。</p>
<p>再说回系统默认启动的 X 进程，我们可以在这个进程参数中看到 DISPLAY 的值为 :0 。如果依前面所述，此时应该可以查询到监听在 6000 端口的 X 进程。但是这时我们通过 netstat 检查端口，会发现这个端口并不会被占用。出现这种现象的原因是系统默认启动的 X 进程带有 -nolisten tcp 参数，禁用了 tcp 监听功能。</p>
<p>如果我们自行启动一个 X 进程，它默认是不带 -nolisten tcp 参数的。我们可以自行定义 DISPLAY 变量，例如 X :1 ，就可以捕捉到监听在 6001 端口的 X 服务。</p>
<h3 id="基于网络运行图形界面">基于网络运行图形界面</h3>
<p>在现实使用中，为用户提供远程桌面连接一般使用基于 RFB 协议的 VNC 或者基于 RDP 协议的 Xrdp ，其实可以直接使用 X Window System 来实现。</p>
<p>在 X Server 和 X Client 同在一台机器上时，它们可以通过 UNIX socket 来实现通信。如果要实现 X Server 和 X Client 远程通信，则需要通过 TCP socket 来实现。</p>
<p>远程通信还需要解决安全问题， X Window System 自身提供多种安全认证的机制，但是最安全的方式是使用 OpenSSH X11 Forwarding 。</p>
<p>依据前面的理论，要基于网络运行图形界面，本地机器需要启动 X Server 服务，远端机器提供 X Client ，从远端的 X Client 到本地的 X Server 要使用 X11 Forwarding 来解决安全问题。 X11 Forwarding 实际上就是端口转发。我们可以先进行实践，再进行分析探究。</p>
<p>以下是需要在本地机器和远端机器进行的工作，完成后可以直接启动远程图形界面：</p>
<hr>
<ul>
<li>远端需要完成的工作</li>
</ul>
<p>首先需要为远端机器安装 X Client ，可以自行选择安装需要的桌面套件或者只安装需要的 X Client ，然后开启 SSH daemon 的 X11 Forwarding 支持。</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">$ yum group install xfce -y  <span class="c1"># 安装 X Client </span>
$ vi /etc/ssh/sshd_config 
......
X11Forwarding yes  <span class="c1"># 开启 X11 Forwarding </span>
......
$ systemctl restart sshd  <span class="c1"># 开启后重启 daemon 使配置生效</span>
</code></pre></div><p>我们平时在使用 ssh 去登录远程机器时，可能会出现 WARNING! The remote SSH server rejected X11 forwarding request. 的报错，这就说明远程机器的 X11 Forwarding 功能被禁用了。如果要在网络上运行图形界面，那么 X Client 所在的远程机器必须打开这个功能。</p>
<hr>
<ul>
<li>本地需要完成的工作</li>
</ul>
<p>为了不与现有的图形环境冲突，启动一个新的 X 进程。</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">$ X :1 <span class="p">&amp;</span>  <span class="c1"># 指定 DISPLAY 运行 X ，这里 DISPLAY 可以任意取值，尽量避免端口冲突</span>
</code></pre></div><p>然后设置 DISPLAY 环境变量，这个是必须的步骤，它会作为 ssh 设置端口转发的依据。</p>
<p>设置完成后直接发起带 X11 Forwarding 的 ssh 登录请求，在登录成功后就可以启动远程 X Client 了。</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">$ <span class="nb">export</span> <span class="nv">DISPLAY</span><span class="o">=</span>:1  <span class="c1"># 这里的值和前面 X 的 DISPLAY 值需要保持一致，这个变量设置错误会导致转发出错</span>
$ ssh -X user@remotehost  <span class="c1"># -X 启动 X11 Forwarding 功能，远端此时应该已经开启 X11Forwarding yes</span>
......  <span class="c1"># 进入远程连接</span>
<span class="o">[</span>user@remotehost ~<span class="o">]</span>$ startxfce4  <span class="c1"># 启动 xfce 桌面，此时会在本地 X Server 中显示远程的 xfce 桌面</span>
<span class="o">[</span>user@remotehost ~<span class="o">]</span>$ firefox  <span class="c1"># 启动单一的 X Client 而不是桌面套件，此时会在本地 X Server 中开启 firefox 浏览器</span>
</code></pre></div><hr>
<h3 id="运行时分析-1">运行时分析</h3>
<p>按照以上的步骤，可以建立起两台机器之间的 X Window System 通信。下面进行简单的分析：</p>
<ul>
<li>
<p>在 X Server 端所在的机器，如果启动 X 进程而且不关闭 tcp 监听，通过 netstat 抓取到的端口号为 DISPLAY 的 6000 加上 displaynumber 。如果启动的 X 进程关闭了 tcp 监听，就无法抓取到监听端口，作为替换的结果是你可以追踪到一个打开的 Unix Socket 。</p>
</li>
<li>
<p>在本地使用 startxfce4 启动图形界面后，使用命令行可以输出得到 DISPLAY 值为 6000 加上 X11DisplayOffset 。 X11DisplayOffset 和 X11Forwarding 一样定义在 X Client 所在的机器的 /etc/ssh/sshd_config 中。</p>
</li>
</ul>
<p>我们可以知道大概的运行过程是这样：在设置了 DISPLAY 环境变量的 shell 启动 ssh -X 会话后，这个会话启动时会把 DISPLAY 的值进行端口映射，远程的映射信息是在远程的 /etc/ssh/sshd_config 中设置的。 ssh 连接成功就意味着端口转发的建立，在远程机器上的 X Client 并不感知这个端口已经被转发，它会正常地进行通信，并被本地的 X Server 显示。</p>
<h2 id="总结">总结</h2>
<p>X Window System 是 Linux 上运行图形界面的基础，这个是使用图形界面必要了解的理论部分。</p>
<p>在本地使用图形界面比较简单，大部分情况下可以之间安装对应软件即可之间使用。比较特殊还是在远程运行图形界面，需要进行一些配置的修改才能成功，但是 X Window System 的性能比较一般，对图形界面有更高的要求一般不使用。</p>
<p>所以这篇笔记适用于最小安装的本地环境或者简单的内网环境。</p></article>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>
</div>
<script>
 
 
 
 window.onload = function () {
   const header = document.getElementById('post-header');
   const headerHeight = header.offsetHeight;
   
   document.documentElement.style.scrollPaddingTop = headerHeight + 10 + "px";
 }

 const tocToggleButton = document.getElementById("toc-toggle");

 const tippyInstance = tippy('#toc-toggle', {
  trigger: 'click',
  content: '<div id="table-of-contents">\u003cnav id=\u0022TableOfContents\u0022\u003e\n  \u003cul\u003e\n    \u003cli\u003e\u003ca href=\u0022#图形界面的运行原理\u0022\u003e图形界面的运行原理\u003c\/a\u003e\u003c\/li\u003e\n    \u003cli\u003e\u003ca href=\u0022#传统serverclinet架构和x-window-system架构的区别\u0022\u003e传统Server\/Clinet架构和X Window System架构的区别\u003c\/a\u003e\n      \u003cul\u003e\n        \u003cli\u003e\u003ca href=\u0022#传统serverclinet架构\u0022\u003e传统Server\/Clinet架构\u003c\/a\u003e\u003c\/li\u003e\n        \u003cli\u003e\u003ca href=\u0022#x-window-system架构\u0022\u003eX Window System架构\u003c\/a\u003e\u003c\/li\u003e\n      \u003c\/ul\u003e\n    \u003c\/li\u003e\n    \u003cli\u003e\u003ca href=\u0022#使用-centos-图形界面\u0022\u003e使用 CentOS 图形界面\u003c\/a\u003e\n      \u003cul\u003e\n        \u003cli\u003e\u003ca href=\u0022#安装本地图形界面\u0022\u003e安装本地图形界面\u003c\/a\u003e\u003c\/li\u003e\n        \u003cli\u003e\u003ca href=\u0022#运行时分析\u0022\u003e运行时分析\u003c\/a\u003e\u003c\/li\u003e\n        \u003cli\u003e\u003ca href=\u0022#基于网络运行图形界面\u0022\u003e基于网络运行图形界面\u003c\/a\u003e\u003c\/li\u003e\n        \u003cli\u003e\u003ca href=\u0022#运行时分析-1\u0022\u003e运行时分析\u003c\/a\u003e\u003c\/li\u003e\n      \u003c\/ul\u003e\n    \u003c\/li\u003e\n    \u003cli\u003e\u003ca href=\u0022#总结\u0022\u003e总结\u003c\/a\u003e\u003c\/li\u003e\n  \u003c\/ul\u003e\n\u003c\/nav\u003e</div>',
  allowHTML: true,
  placement: 'bottom-start',
  interactive: true,
  arrow: false,
  maxWidth: "none",
  onHide: function () { tocToggleButton.classList.remove("hover"); },
  onShow: function () { tocToggleButton.classList.add("hover"); },
  onShown: function () {
    selectTableOfContentsOption();

    if (window.hasSetupTableOfContentsListeners) {
      return;
    }

    const tableOfContents = document.getElementById("table-of-contents");
    tableOfContents.addEventListener('click', function () {
      
      tippyInstance[0].hide();
    });

    window.hasSetupTableOfContentsListeners = true;
  }
 });

 function selectTableOfContentsOption () {
   const optionSelectedClass = 'table-of-contents-option-selected';

   const tableOfContentsOptions = document.querySelectorAll("#table-of-contents > nav > ul li");

   for (const option of tableOfContentsOptions) {
     

     const [child] = option.children;
     if (child.tagName.toLowerCase() !== 'a') {
       continue;
     }

     if (window.location.href === child.href) {
       child.classList.add(optionSelectedClass);
     } else {
       child.classList.remove(optionSelectedClass);
     }
   }
 }

 window.onhashchange = selectTableOfContentsOption;
</script>


  <div class="footer container-xl width-full p-responsive">
  <div
    class="position-relative d-flex flex-row-reverse flex-lg-row flex-wrap flex-lg-nowrap flex-justify-center flex-lg-justify-between flex-sm-items-center pt-6 pb-2 mt-6 f6 text-gray border-top border-gray-light ">
    <a aria-label="Homepage" title="GitHub" class="footer-octicon d-none d-lg-block mr-lg-4" href="https://yuweizzz.github.io">
      <svg height="24" class="octicon octicon-mark-github" viewBox="0 0 16 16" version="1.1" width="24">
        <path fill-rule="evenodd"
          d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z">
        </path>
      </svg>
    </a>
    <ul class="list-style-none d-flex flex-wrap col-12 flex-justify-center flex-lg-justify-between mb-2 mb-lg-0">
      
      <li class="mr-3 mr-lg-0">Theme by <a href='https://github.com/MeiK2333/github-style'>github-style</a></li>
      
    </ul>
  </div>
  <div class="d-flex flex-justify-center pb-6">
    <span class="f6 text-gray-light"></span>
  </div>


</div>
</body>

<script type="application/javascript" src="https://yuweizzz.github.io/js/github-style.js"></script>


<script src="https://cubism.live2d.com/sdk-web/cubismcore/live2dcubismcore.min.js"></script>
<script type="text/javascript" src="https://yuweizzz.github.io/js/CustomLive2D.js"></script>


</html>