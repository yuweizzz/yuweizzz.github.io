<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <script type="application/javascript" src='https://yuweizzz.github.io/js/theme-mode.js'></script>
    <link rel="stylesheet" href='https://yuweizzz.github.io/css/frameworks.min.css' />
    <link rel="stylesheet" href='https://yuweizzz.github.io/css/github.min.css' />
    <link rel="stylesheet" href='https://yuweizzz.github.io/css/github-style.css' />
    <link rel="stylesheet" href='https://yuweizzz.github.io/css/light.css' />
    <link rel="stylesheet" href='https://yuweizzz.github.io/css/dark.css' />
    <link rel="stylesheet" href='https://yuweizzz.github.io/css/syntax.css' />
    <title>Debian 系统实用技巧笔记 - Wei&#39;s blog</title>
    
    <link rel="icon" type="image/x-icon" href='/images/favicon.svg'>
    
    <meta name="theme-color" content="#1e2327">

    
    <script type="text/javascript" src="https://yuweizzz.github.io/js/CustomLive2D.js"></script><script type="text/javascript" src="https://cubism.live2d.com/sdk-web/cubismcore/live2dcubismcore.min.js"></script>

    
    <meta name="description"
  content="这篇笔记用来记录 Debian 系统中的一些实用技巧。
" />
<meta name="keywords"
  content='blog, google analytics' />
<meta name="robots" content="noodp" />
<link rel="canonical" href="https://yuweizzz.github.io/post/practical_tips_in_debian/" />


<meta name="twitter:card" content="summary" />
<meta name="twitter:title" content="Debian 系统实用技巧笔记 - Wei&#39;s blog" />
<meta name="twitter:description"
  content="这篇笔记用来记录 Debian 系统中的一些实用技巧。
" />
<meta name="twitter:site" content="https://yuweizzz.github.io/" />
<meta name="twitter:creator" content="" />
<meta name="twitter:image"
  content="https://yuweizzz.github.io/">


<meta property="og:type" content="article" />
<meta property="og:title" content="Debian 系统实用技巧笔记 - Wei&#39;s blog">
<meta property="og:description"
  content="这篇笔记用来记录 Debian 系统中的一些实用技巧。
" />
<meta property="og:url" content="https://yuweizzz.github.io/post/practical_tips_in_debian/" />
<meta property="og:site_name" content="Debian 系统实用技巧笔记" />
<meta property="og:image"
  content="https://yuweizzz.github.io/">
<meta property="og:image:width" content="2048">
<meta property="og:image:height" content="1024">

<meta property="article:published_time" content="2023-12-23 15:00:00 &#43;0000 UTC" />











  
    
      <script async src="https://www.googletagmanager.com/gtag/js?id=G-RFSQDKSFR1"></script>
      <script>
        var doNotTrack = false;
        if ( false ) {
          var dnt = (navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack);
          var doNotTrack = (dnt == "1" || dnt == "yes");
        }
        if (!doNotTrack) {
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'G-RFSQDKSFR1');
        }
      </script>
    
  




</head>


<body>
  <div style="position: relative">
  <header class="Header js-details-container Details px-3 px-md-4 px-lg-5 flex-wrap flex-md-nowrap open Details--on">
    <div class="Header-item mobile-none" style="margin-top: -4px; margin-bottom: -4px;">
      <a class="Header-link" href="https://yuweizzz.github.io/">
        <img class="octicon" height="32" width="32" src="/images/github-mark-white.png">
      </a>
    </div>
    <div class="Header-item d-md-none">
      <button class="Header-link btn-link js-details-target" type="button"
        onclick="document.querySelector('#header-search').style.display = document.querySelector('#header-search').style.display == 'none'? 'block': 'none'">
        <svg height="24" class="octicon octicon-three-bars" viewBox="0 0 16 16" version="1.1" width="24">
          <path fill-rule="evenodd" d="M1 2.75A.75.75 0 011.75 2h12.5a.75.75 0 110 1.5H1.75A.75.75 0 011 2.75zm0 5A.75.75 0 011.75 7h12.5a.75.75 0 110 1.5H1.75A.75.75 0 011 7.75zM1.75 12a.75.75 0 100 1.5h12.5a.75.75 0 100-1.5H1.75z">
          </path>
        </svg>
      </button>
    </div>
    <div style="display: none;" id="header-search"
      class="Header-item Header-item--full flex-column flex-md-row width-full flex-order-2 flex-md-order-none mr-0 mr-md-3 mt-3 mt-md-0 Details-content--hidden-not-important d-md-flex">
      <div
        class="Header-search header-search flex-auto js-site-search position-relative flex-self-stretch flex-md-self-auto mb-3 mb-md-0 mr-0 mr-md-3 scoped-search site-scoped-search js-jump-to">
        <div class="position-relative">
          
          <form target="_blank" id="search-form" action="" accept-charset="UTF-8" method="get"
            autocomplete="off">
            <label
              class="Header-search-label form-control input-sm header-search-wrapper p-0 js-chromeless-input-container header-search-wrapper-jump-to position-relative d-flex flex-justify-between flex-items-center">
              <input type="text"
                class="Header-search-input form-control input-sm header-search-input jump-to-field js-jump-to-field js-site-search-focus js-site-search-field is-clearable"
                name="q" value="" placeholder="Search" autocomplete="off">
            </label>
          </form>
          
        </div>
      </div>
    </div>

    <div class="Header-item Header-item--full flex-justify-center d-md-none position-relative">
      <a class="Header-link " href="https://yuweizzz.github.io/">
        <img class="octicon octicon-mark-github v-align-middle" height="32" width="32" src="/images/github-mark-white.png">
      </a>
    </div>
    <div class="Header-item" style="margin-right: 0;">
      <a href="javascript:void(0)" class="Header-link no-select" onclick="switchTheme()">
        <svg style="fill: var(--color-profile-color-modes-toggle-moon);" class="no-select" viewBox="0 0 16 16"
          version="1.1" width="16" height="16">
          <path fill-rule="evenodd" clip-rule="evenodd"
            d="M4.52208 7.71754C7.5782 7.71754 10.0557 5.24006 10.0557 2.18394C10.0557 1.93498 10.0392 1.68986 10.0074 1.44961C9.95801 1.07727 10.3495 0.771159 10.6474 0.99992C12.1153 2.12716 13.0615 3.89999 13.0615 5.89383C13.0615 9.29958 10.3006 12.0605 6.89485 12.0605C3.95334 12.0605 1.49286 10.001 0.876728 7.24527C0.794841 6.87902 1.23668 6.65289 1.55321 6.85451C2.41106 7.40095 3.4296 7.71754 4.52208 7.71754Z">
          </path>
        </svg>
      </a>
    </div>
  </header>
</div>

  <div id="search-result" class="container-lg px-3 new-discussion-timeline" style="display: none;">
</div>

  
<div class="application-main">
  <div>
  <main>
    <div class="gisthead pagehead bg-gray-light pb-0 pt-3 mb-4">
      <div class="px-0">
        <div class="mb-3 d-flex px-3 px-md-3 px-lg-5">
          <div class="flex-auto min-width-0 width-fit mr-3">
            <div class="d-flex">
              <div class="d-none d-md-block">
                <a class="avatar mr-2 flex-shrink-0" href="https://yuweizzz.github.io/">
                  <img class=" avatar-user"
                    src="https://yuweizzz.github.io/images/avatar.png"
                    width="32" height="32"></a>
              </div>
              <div class="d-flex flex-column">
                <h1 class="break-word f3 text-normal mb-md-0 mb-1">
                  <span class="author">
                    <a href="https://yuweizzz.github.io/">Wei</a>
                  </span>
                  <span class="path-divider">/</span>
                  <strong class="css-truncate css-truncate-target mr-1" style="max-width: 410px">
                    <a href="https://yuweizzz.github.io/post/practical_tips_in_debian/">Debian 系统实用技巧笔记</a>
                  </strong>
                </h1>
                <div class="note m-0">
                  Created <relative-time datetime="Sat, 23 Dec 2023 15:00:00 &#43;0000"
                    class="no-wrap">
                    Sat, 23 Dec 2023 15:00:00 &#43;0000</relative-time>

                  
                  <span class="file-info-divider"></span>
                  Modified <relative-time datetime="Sun, 01 Mar 2026 09:47:51 &#43;0000"
                    class="no-wrap">
                    Sun, 01 Mar 2026 09:47:51 &#43;0000</relative-time>
                  
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="container-lg px-3 new-discussion-timeline">
      <div class="repository-content gist-content">
        <div>
          <div class="js-gist-file-update-container js-task-list-container file-box">
            <div id="file-pytest" class="file my-2">
              <div id="post-header" class="file-header d-flex flex-md-items-center flex-items-start sticky-header" style="z-index: 2">
                <div class="file-info d-flex flex-md-items-center flex-items-start flex-order-1 flex-auto">
                  <div class="text-mono f6 flex-auto pr-3 flex-order-2 flex-md-order-1 mt-2 mt-md-0">
                    
                    <summary id="toc-toggle" onclick="clickToc()" class="btn btn-octicon m-0 mr-2 p-2">
                      <svg aria-hidden="true" viewBox="0 0 16 16" height="16" width="16" class="octicon octicon-list-unordered">
                        <path fill-rule="evenodd" d="M2 4a1 1 0 100-2 1 1 0 000 2zm3.75-1.5a.75.75 0 000 1.5h8.5a.75.75 0 000-1.5h-8.5zm0 5a.75.75 0 000 1.5h8.5a.75.75 0 000-1.5h-8.5zm0 5a.75.75 0 000 1.5h8.5a.75.75 0 000-1.5h-8.5zM3 8a1 1 0 11-2 0 1 1 0 012 0zm-1 6a1 1 0 100-2 1 1 0 000 2z"></path>
                      </svg>
                    </summary>
                    <details-menu class="SelectMenu" id="toc-details" style="display: none;">
                      <div class="SelectMenu-modal rounded-3 mt-1" style="max-height: 340px;">
                        <div class="SelectMenu-list SelectMenu-list--borderless p-2" style="overscroll-behavior: contain;" id="toc-list">
                        </div>
                      </div>
                    </details-menu>
                      2900 Words
                    

                  </div>
                  <div class="file-actions flex-order-2 pt-0">
                    
                    
                    <a class="muted-link mr-3" href="https://yuweizzz.github.io/tags/linux">
                      <svg class="octicon octicon-tag" viewBox="0 0 16 16" version="1.1" width="16" height="16">
                        <path fill-rule="evenodd"
                          d="M2.5 7.775V2.75a.25.25 0 01.25-.25h5.025a.25.25 0 01.177.073l6.25 6.25a.25.25 0 010 .354l-5.025 5.025a.25.25 0 01-.354 0l-6.25-6.25a.25.25 0 01-.073-.177zm-1.5 0V2.75C1 1.784 1.784 1 2.75 1h5.025c.464 0 .91.184 1.238.513l6.25 6.25a1.75 1.75 0 010 2.474l-5.026 5.026a1.75 1.75 0 01-2.474 0l-6.25-6.25A1.75 1.75 0 011 7.775zM6 5a1 1 0 100 2 1 1 0 000-2z">
                        </path>
                      </svg>
                      Linux
                    </a>
                    
                    <a class="muted-link mr-3" href="https://yuweizzz.github.io/tags/debian">
                      <svg class="octicon octicon-tag" viewBox="0 0 16 16" version="1.1" width="16" height="16">
                        <path fill-rule="evenodd"
                          d="M2.5 7.775V2.75a.25.25 0 01.25-.25h5.025a.25.25 0 01.177.073l6.25 6.25a.25.25 0 010 .354l-5.025 5.025a.25.25 0 01-.354 0l-6.25-6.25a.25.25 0 01-.073-.177zm-1.5 0V2.75C1 1.784 1.784 1 2.75 1h5.025c.464 0 .91.184 1.238.513l6.25 6.25a1.75 1.75 0 010 2.474l-5.026 5.026a1.75 1.75 0 01-2.474 0l-6.25-6.25A1.75 1.75 0 011 7.775zM6 5a1 1 0 100 2 1 1 0 000-2z">
                        </path>
                      </svg>
                      Debian
                    </a>
                    
                    
                  </div>
                </div>
              </div>


              <div class="Box-body px-5 pb-5" style="z-index: 1">
                <article class="markdown-body entry-content container-lg"><p>这篇笔记用来记录 Debian 系统中的一些实用技巧。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                                       <span class="o">(</span>@@<span class="o">)</span> <span class="o">(</span>  <span class="o">)</span> <span class="o">(</span>@<span class="o">)</span>  <span class="o">(</span> <span class="o">)</span>  @@    <span class="o">()</span>    @     O     @     O      @
</span></span><span class="line"><span class="cl">                                  <span class="o">(</span>   <span class="o">)</span>
</span></span><span class="line"><span class="cl">                              <span class="o">(</span>@@@@<span class="o">)</span>
</span></span><span class="line"><span class="cl">                           <span class="o">(</span>    <span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                         <span class="o">(</span>@@@<span class="o">)</span>
</span></span><span class="line"><span class="cl">                       <span class="o">====</span>        ________                ___________
</span></span><span class="line"><span class="cl">                   _D _<span class="p">|</span>  <span class="p">|</span>_______/        <span class="se">\_</span>_I_I_____<span class="o">===</span>__<span class="p">|</span>_________<span class="p">|</span>
</span></span><span class="line"><span class="cl">                    <span class="p">|</span><span class="o">(</span>_<span class="o">)</span>---  <span class="p">|</span>   H<span class="se">\_</span>_______/ <span class="p">|</span>   <span class="p">|</span>        <span class="o">=</span><span class="p">|</span>___ ___<span class="p">|</span>      _________________
</span></span><span class="line"><span class="cl">                    /     <span class="p">|</span>  <span class="p">|</span>   H  <span class="p">|</span>  <span class="p">|</span>     <span class="p">|</span>   <span class="p">|</span>         <span class="o">||</span>_<span class="p">|</span> <span class="p">|</span>_<span class="o">||</span>     _<span class="p">|</span>                <span class="se">\_</span>____A
</span></span><span class="line"><span class="cl">                   <span class="p">|</span>      <span class="p">|</span>  <span class="p">|</span>   H  <span class="p">|</span>__--------------------<span class="p">|</span> <span class="o">[</span>___<span class="o">]</span> <span class="p">|</span>   <span class="o">=</span><span class="p">|</span>                        <span class="p">|</span>
</span></span><span class="line"><span class="cl">                   <span class="p">|</span> ________<span class="p">|</span>___H__/__<span class="p">|</span>_____/<span class="o">[][]</span>~<span class="se">\_</span>______<span class="p">|</span>       <span class="p">|</span>   -<span class="p">|</span>                        <span class="p">|</span>
</span></span><span class="line"><span class="cl">                   <span class="p">|</span>/ <span class="p">|</span>   <span class="p">|</span>-----------I_____I <span class="o">[][]</span> <span class="o">[]</span>  D   <span class="p">|</span><span class="o">=======</span><span class="p">|</span>____<span class="p">|</span>________________________<span class="p">|</span>_
</span></span><span class="line"><span class="cl">                 __/ <span class="o">=</span><span class="p">|</span> o <span class="p">|</span><span class="o">=</span>-~O<span class="o">=====</span><span class="nv">O</span><span class="o">=====</span><span class="nv">O</span><span class="o">=====</span>O<span class="se">\ </span>____Y___________<span class="p">|</span>__<span class="p">|</span>__________________________<span class="p">|</span>_
</span></span><span class="line"><span class="cl">                  <span class="p">|</span>/-<span class="o">=</span><span class="p">|</span>___<span class="p">|</span><span class="o">=</span>    <span class="o">||</span>    <span class="o">||</span>    <span class="o">||</span>    <span class="p">|</span>_____/~<span class="se">\_</span>__/          <span class="p">|</span>_D__D__D_<span class="p">|</span>  <span class="p">|</span>_D__D__D_<span class="p">|</span>
</span></span><span class="line"><span class="cl">                   <span class="se">\_</span>/      <span class="se">\_</span>_/  <span class="se">\_</span>_/  <span class="se">\_</span>_/  <span class="se">\_</span>_/      <span class="se">\_</span>/               <span class="se">\_</span>/   <span class="se">\_</span>/    <span class="se">\_</span>/   <span class="se">\_</span>/
</span></span></code></pre></div><h2 id="配置-debian-源">配置 Debian 源</h2>
<p>dpkg 和 apt 是 Debian 系列 Linux 发行版的软件包管理器，其中 dpkg 是比较底层的软件包工具，而 apt 则是更高层级的管理工具，两者之间的关系类似于 rpm 和 yum 的关系。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 修改 Debian 10 buster 镜像源</span>
</span></span><span class="line"><span class="cl">$ <span class="nb">echo</span> <span class="s1">&#39;deb http://mirrors.ustc.edu.cn/debian buster main contrib non-free
</span></span></span><span class="line"><span class="cl"><span class="s1">deb http://mirrors.ustc.edu.cn/debian buster-updates main contrib non-free
</span></span></span><span class="line"><span class="cl"><span class="s1">deb http://mirrors.ustc.edu.cn/debian buster-backports main contrib non-free
</span></span></span><span class="line"><span class="cl"><span class="s1">deb http://mirrors.ustc.edu.cn/debian-security/ buster/updates main contrib non-free&#39;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  &gt; /etc/apt/sources.list
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 更新软件列表</span>
</span></span><span class="line"><span class="cl">$ apt update
</span></span></code></pre></div><h3 id="配置不稳定镜像源获取最新版本软件">配置不稳定镜像源获取最新版本软件</h3>
<p>为了能够使用一些版本比较高的软件，有时候可能需要将镜像源配置为不稳定版本，在 Debian 中不稳定版本的镜像源代号为 sid ，这个镜像源通常包括了一些最新版本但是还不稳定的软件。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 添加 Debian sid 镜像源</span>
</span></span><span class="line"><span class="cl">$ <span class="nb">echo</span> deb https://mirrors.aliyun.com/debian/ sid main contrib non-free non-free-firmware <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  &gt; /etc/apt/sources.list.d/sid.list
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 更新软件列表</span>
</span></span><span class="line"><span class="cl">$ apt update
</span></span></code></pre></div><h3 id="配置镜像源的优先级">配置镜像源的优先级</h3>
<p>虽然可以通过添加 sid 镜像源来获取最新软件，但是这个操作是有一定危险性的，所以在添加 sid 源后千万不要使用 <code>apt upgrade</code> 更新所有软件，最好在安装完需要的某部分软件后，把 sid 源的优先级降低。</p>
<p>使用 sid 镜像源可能会将你的系统版本信息标记为不稳定版本，这样会产生一些奇怪的问题，非常不建议在生产环境上使用。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 添加镜像源的优先级配置</span>
</span></span><span class="line"><span class="cl">$ cat /etc/apt/preferences.d/sid
</span></span><span class="line"><span class="cl">Package: *
</span></span><span class="line"><span class="cl">Pin: release <span class="nv">o</span><span class="o">=</span>Debian,a<span class="o">=</span>unstable,n<span class="o">=</span>sid
</span></span><span class="line"><span class="cl">Pin-Priority: <span class="m">50</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 更新软件列表</span>
</span></span><span class="line"><span class="cl">$ apt update
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 默认的镜像源优先级是 500 ，越大的优先级会被优先使用</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 以下输出是一台调整过优先级的 Debian 11 系统的运行信息，可以看到 sid 源的优先级已经被降低</span>
</span></span><span class="line"><span class="cl">$ apt-cache policy
</span></span><span class="line"><span class="cl">Package files:
</span></span><span class="line"><span class="cl"> <span class="m">100</span> /var/lib/dpkg/status
</span></span><span class="line"><span class="cl">     release <span class="nv">a</span><span class="o">=</span>now
</span></span><span class="line"><span class="cl">  <span class="m">50</span> https://mirrors.aliyun.com/debian sid/non-free-firmware amd64 Packages
</span></span><span class="line"><span class="cl">     release <span class="nv">o</span><span class="o">=</span>Debian,a<span class="o">=</span>unstable,n<span class="o">=</span>sid,l<span class="o">=</span>Debian,c<span class="o">=</span>non-free-firmware,b<span class="o">=</span>amd64
</span></span><span class="line"><span class="cl">     origin mirrors.aliyun.com
</span></span><span class="line"><span class="cl">  <span class="m">50</span> https://mirrors.aliyun.com/debian sid/non-free amd64 Packages
</span></span><span class="line"><span class="cl">     release <span class="nv">o</span><span class="o">=</span>Debian,a<span class="o">=</span>unstable,n<span class="o">=</span>sid,l<span class="o">=</span>Debian,c<span class="o">=</span>non-free,b<span class="o">=</span>amd64
</span></span><span class="line"><span class="cl">     origin mirrors.aliyun.com
</span></span><span class="line"><span class="cl">  <span class="m">50</span> https://mirrors.aliyun.com/debian sid/contrib amd64 Packages
</span></span><span class="line"><span class="cl">     release <span class="nv">o</span><span class="o">=</span>Debian,a<span class="o">=</span>unstable,n<span class="o">=</span>sid,l<span class="o">=</span>Debian,c<span class="o">=</span>contrib,b<span class="o">=</span>amd64
</span></span><span class="line"><span class="cl">     origin mirrors.aliyun.com
</span></span><span class="line"><span class="cl">  <span class="m">50</span> https://mirrors.aliyun.com/debian sid/main amd64 Packages
</span></span><span class="line"><span class="cl">     release <span class="nv">o</span><span class="o">=</span>Debian,a<span class="o">=</span>unstable,n<span class="o">=</span>sid,l<span class="o">=</span>Debian,c<span class="o">=</span>main,b<span class="o">=</span>amd64
</span></span><span class="line"><span class="cl">     origin mirrors.aliyun.com
</span></span><span class="line"><span class="cl"> <span class="m">500</span> http://deb.debian.org/debian bullseye-updates/main amd64 Packages
</span></span><span class="line"><span class="cl">     release <span class="nv">v</span><span class="o">=</span>11-updates,o<span class="o">=</span>Debian,a<span class="o">=</span>oldstable-updates,n<span class="o">=</span>bullseye-updates,l<span class="o">=</span>Debian,c<span class="o">=</span>main,b<span class="o">=</span>amd64
</span></span><span class="line"><span class="cl">     origin deb.debian.org
</span></span><span class="line"><span class="cl"> <span class="m">500</span> http://security.debian.org/debian-security bullseye-security/main amd64 Packages
</span></span><span class="line"><span class="cl">     release <span class="nv">v</span><span class="o">=</span>11,o<span class="o">=</span>Debian,a<span class="o">=</span>oldstable-security,n<span class="o">=</span>bullseye-security,l<span class="o">=</span>Debian-Security,c<span class="o">=</span>main,b<span class="o">=</span>amd64
</span></span><span class="line"><span class="cl">     origin security.debian.org
</span></span><span class="line"><span class="cl"> <span class="m">500</span> http://deb.debian.org/debian bullseye/main amd64 Packages
</span></span><span class="line"><span class="cl">     release <span class="nv">v</span><span class="o">=</span>11.8,o<span class="o">=</span>Debian,a<span class="o">=</span>oldstable,n<span class="o">=</span>bullseye,l<span class="o">=</span>Debian,c<span class="o">=</span>main,b<span class="o">=</span>amd64
</span></span><span class="line"><span class="cl">     origin deb.debian.org
</span></span></code></pre></div><h3 id="一些重要软件的独立镜像源">一些重要软件的独立镜像源</h3>
<p>这里会记录一些重要软件的独立镜像源，以便需要时能够快速安装。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># jenkins Debian LTS release</span>
</span></span><span class="line"><span class="cl">$ curl -fsSL https://pkg.jenkins.io/debian-stable/jenkins.io-2023.key <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  &gt; /usr/share/keyrings/jenkins-keyring.asc
</span></span><span class="line"><span class="cl">$ <span class="nb">echo</span> <span class="s2">&#34;deb [signed-by=/usr/share/keyrings/jenkins-keyring.asc] \
</span></span></span><span class="line"><span class="cl"><span class="s2">  https://pkg.jenkins.io/debian-stable binary/&#34;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  &gt; /etc/apt/sources.list.d/jenkins.list
</span></span><span class="line"><span class="cl">$ apt update
</span></span><span class="line"><span class="cl">$ apt install jenkins
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># docker-ce</span>
</span></span><span class="line"><span class="cl">$ curl -fsSL https://download.docker.com/linux/debian/gpg <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  &gt; /usr/share/keyrings/docker-ce-keyring.asc
</span></span><span class="line"><span class="cl">$ <span class="nb">echo</span> <span class="s2">&#34;deb [arch=&#34;</span><span class="k">$(</span>dpkg --print-architecture<span class="k">)</span><span class="s2">&#34; signed-by=/usr/share/keyrings/docker-ce-keyring.asc] \
</span></span></span><span class="line"><span class="cl"><span class="s2">  https://download.docker.com/linux/debian &#34;</span><span class="k">$(</span>. /etc/os-release <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;</span><span class="nv">$VERSION_CODENAME</span><span class="s2">&#34;</span><span class="k">)</span><span class="s2">&#34; stable&#34;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  &gt; /etc/apt/sources.list.d/docker-ce.list
</span></span><span class="line"><span class="cl">$ apt update
</span></span><span class="line"><span class="cl">$ apt install docker-ce docker-ce-cli containerd.io docker-compose-plugin
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># openresty</span>
</span></span><span class="line"><span class="cl">$ curl -fsSL https://openresty.org/package/pubkey.gpg <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  &gt; /usr/share/keyrings/openresty-keyring.asc
</span></span><span class="line"><span class="cl">$ <span class="nb">echo</span> <span class="s2">&#34;deb [signed-by=/usr/share/keyrings/openresty-keyring.asc] http://openresty.org/package/debian \
</span></span></span><span class="line"><span class="cl"><span class="s2">  &#34;</span><span class="k">$(</span>. /etc/os-release <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;</span><span class="nv">$VERSION_CODENAME</span><span class="s2">&#34;</span><span class="k">)</span><span class="s2">&#34; openresty&#34;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  &gt; /etc/apt/sources.list.d/openresty.list
</span></span><span class="line"><span class="cl">$ apt update
</span></span><span class="line"><span class="cl">$ apt install openresty
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># mysql</span>
</span></span><span class="line"><span class="cl">$ wget https://dev.mysql.com/get/mysql-apt-config_0.8.15-1_all.deb
</span></span><span class="line"><span class="cl"><span class="c1"># mysql-apt-config 实际上就是安装对应的 apt 镜像源和签名信息的步骤</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 0.8.15 版本的 mysql-apt-config 可以下载安装 mysql 5.7 和 mysql 8.0</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 新版本的 mysql-apt-config 只能下载安装 mysql 8.0</span>
</span></span><span class="line"><span class="cl">$ dpkg -i mysql-apt-config_0.8.15-1_all.deb
</span></span><span class="line"><span class="cl"><span class="c1"># 安装完成后会跳出图形界面，可以自行选择需要的镜像源，这里选择的是 mysql 5.7</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 配置完成后想要修改的话可以通过以下命令重新打开</span>
</span></span><span class="line"><span class="cl">$ dpkg-reconfigure mysql-apt-config
</span></span><span class="line"><span class="cl"><span class="c1"># 执行实际的安装步骤</span>
</span></span><span class="line"><span class="cl">$ apt update
</span></span><span class="line"><span class="cl">$ apt install mysql-community-server
</span></span></code></pre></div><h2 id="调整网卡配置">调整网卡配置</h2>
<p>Debian 系统使用的网卡配置文件是 <code>/etc/network/interfaces</code> 和 <code>/etc/network/interfaces.d/*</code> ，一般会在这里调整网卡的 IP 地址获取行为。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 默认的 /etc/network/interfaces 配置文件</span>
</span></span><span class="line"><span class="cl">$ cat /etc/network/interfaces
</span></span><span class="line"><span class="cl"><span class="c1"># This file describes the network interfaces available on your system</span>
</span></span><span class="line"><span class="cl"><span class="c1"># and how to activate them. For more information, see interfaces(5).</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">source</span> /etc/network/interfaces.d/*
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># The loopback network interface</span>
</span></span><span class="line"><span class="cl">auto lo
</span></span><span class="line"><span class="cl">iface lo inet loopback
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># The primary network interface</span>
</span></span><span class="line"><span class="cl">allow-hotplug ens33
</span></span><span class="line"><span class="cl">iface ens33 inet dhcp
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 调整网卡为静态 IP 地址后的 /etc/network/interfaces 配置文件</span>
</span></span><span class="line"><span class="cl">$ cat /etc/network/interfaces
</span></span><span class="line"><span class="cl"><span class="c1"># This file describes the network interfaces available on your system</span>
</span></span><span class="line"><span class="cl"><span class="c1"># and how to activate them. For more information, see interfaces(5).</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">source</span> /etc/network/interfaces.d/*
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># The loopback network interface</span>
</span></span><span class="line"><span class="cl">auto lo
</span></span><span class="line"><span class="cl">iface lo inet loopback
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># The primary network interface</span>
</span></span><span class="line"><span class="cl">allow-hotplug ens33
</span></span><span class="line"><span class="cl">auto ens33
</span></span><span class="line"><span class="cl">iface ens33 inet static
</span></span><span class="line"><span class="cl">address 192.168.1.2/23
</span></span><span class="line"><span class="cl">gateway 192.168.1.1
</span></span><span class="line"><span class="cl">dns-nameservers 192.168.1.1
</span></span></code></pre></div><h2 id="vim-兼容性问题">vim 兼容性问题</h2>
<p>在 Debian 的一些版本中默认安装的编辑器是 vim-tiny ，可能会出现比如上下左右方向键变成 ABCD 的字符输入，退格键不能正常删除字符，或者文本粘贴出现异常缩进，可以通过修改 <code>vimrc</code> 来解决。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ cat ~/.vimrc
</span></span><span class="line"><span class="cl"><span class="s2">&#34;解决文本粘贴出现异常缩进&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nb">set</span> paste
</span></span><span class="line"><span class="cl"><span class="s2">&#34;关闭兼容模式，解决上下左右方向键变成 ABCD 的字符输入&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nb">set</span> nocompatible
</span></span><span class="line"><span class="cl"><span class="s2">&#34;解决退格键不能正常删除字符&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nb">set</span> <span class="nv">backspace</span><span class="o">=</span><span class="m">2</span>
</span></span></code></pre></div><h2 id="sshd-安全加固">sshd 安全加固</h2>
<p>sshd 基本上是 Linux 系统必定会运行的服务，一般会增加一些相关的安全配置。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 修改 sshd 服务的配置</span>
</span></span><span class="line"><span class="cl">$ cat /etc/ssh/sshd_config
</span></span><span class="line"><span class="cl"><span class="c1"># 禁止 root 用户登陆</span>
</span></span><span class="line"><span class="cl">PermitRootLogin no
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 禁用通过用户密码验证登陆</span>
</span></span><span class="line"><span class="cl">PasswordAuthentication no
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 启用用户私钥验证登陆</span>
</span></span><span class="line"><span class="cl">PubkeyAuthentication yes
</span></span><span class="line"><span class="cl"><span class="c1"># 验证私钥的公钥来源文件，一般不作修改</span>
</span></span><span class="line"><span class="cl"><span class="c1"># AuthorizedKeysFile .ssh/authorized_keys</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># AllowUsers 和 DenyUsers 可以限制用户登陆，其中 Deny 的优先级高于 Allow</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 除了用户还可以限制登陆来源 IP ，来源 IP 可以是具体 host 或者 CIDR</span>
</span></span><span class="line"><span class="cl">AllowUsers userA@192.168.0.0/24 userA@10.0.0.1
</span></span><span class="line"><span class="cl">DenyUsers userB
</span></span></code></pre></div><h3 id="sshd-算法禁用">sshd 算法禁用</h3>
<p>sshd 用到的一些算法可能已经不安全，所以需要手动禁用。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 查看默认支持的加密算法</span>
</span></span><span class="line"><span class="cl">$ ssh -Q cipher
</span></span><span class="line"><span class="cl"><span class="c1"># 查看默认支持的 mac 算法</span>
</span></span><span class="line"><span class="cl">$ ssh -Q mac
</span></span><span class="line"><span class="cl"><span class="c1"># 查看系统支持的密钥交换算法</span>
</span></span><span class="line"><span class="cl">$ ssh -Q kex
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 大部分情况下使用的 sshd 配置是默认的，可以先进行查询</span>
</span></span><span class="line"><span class="cl">$ sshd -T <span class="p">|</span> grep -i cipher
</span></span><span class="line"><span class="cl">$ sshd -T <span class="p">|</span> grep -i macs
</span></span><span class="line"><span class="cl">$ sshd -T <span class="p">|</span> grep -i kexalgorithms
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 在原有查询的基础上修改 sshd 服务的配置</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 如果是禁用某些算法，直接把它去掉即可</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 如果是新增某些算法，则不应该超出 ssh -Q 查询到的对应算法范围</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 以下是 Debian 11 的默认 sshd 服务配置，可以在这个基础上修改</span>
</span></span><span class="line"><span class="cl">$ cat /etc/ssh/sshd_config
</span></span><span class="line"><span class="cl">Ciphers chacha20-poly1305@openssh.com,aes128-ctr,aes192-ctr,aes256-ctr,aes128-gcm@openssh.com,aes256-gcm@openssh.com
</span></span><span class="line"><span class="cl">MACs macs umac-64-etm@openssh.com,umac-128-etm@openssh.com,hmac-sha2-256-etm@openssh.com,hmac-sha2-512-etm@openssh.com,hmac-sha1-etm@openssh.com,umac-64@openssh.com,umac-128@openssh.com,hmac-sha2-256,hmac-sha2-512,hmac-sha1
</span></span><span class="line"><span class="cl">KexAlgorithms curve25519-sha256,curve25519-sha256@libssh.org,ecdh-sha2-nistp256,ecdh-sha2-nistp384,ecdh-sha2-nistp521,diffie-hellman-group-exchange-sha256,diffie-hellman-group16-sha512,diffie-hellman-group18-sha512,diffie-hellman-group14-sha256
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 一些已知的弱算法</span>
</span></span><span class="line"><span class="cl">Ciphers:
</span></span><span class="line"><span class="cl">3des-cbc
</span></span><span class="line"><span class="cl">aes128-cbc
</span></span><span class="line"><span class="cl">aes192-cbc
</span></span><span class="line"><span class="cl">aes256-cbc
</span></span><span class="line"><span class="cl">blowfish-cbc
</span></span><span class="line"><span class="cl">cast128-cbc
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">MACs:
</span></span><span class="line"><span class="cl">hmac-md5
</span></span><span class="line"><span class="cl">hmac-md5-96
</span></span><span class="line"><span class="cl">hmac-md5-etm@openssh.com
</span></span><span class="line"><span class="cl">hmac-md5-96-etm@openssh.com
</span></span><span class="line"><span class="cl">umac-64-etm@openssh.com
</span></span><span class="line"><span class="cl">umac-64@openssh.com
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">KexAlgorithms:
</span></span><span class="line"><span class="cl">diffie-hellman-group-exchange-sha1
</span></span><span class="line"><span class="cl">diffie-hellman-group1-sha1
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 修改后需要重启 sshd 服务，可以通过命令来验证是否成功</span>
</span></span><span class="line"><span class="cl">$ nmap --script ssh2-enum-algos -sV -p <span class="m">22</span> 127.0.0.1
</span></span><span class="line"><span class="cl">$ ssh -o <span class="nv">Ciphers</span><span class="o">=</span>aes128-cbc root@127.0.0.1
</span></span><span class="line"><span class="cl">$ ssh -o <span class="nv">KexAlgorithms</span><span class="o">=</span>diffie-hellman-group-exchange-sha1 root@127.0.0.1
</span></span></code></pre></div><h3 id="解决-rsa-密钥无法登陆的问题">解决 rsa 密钥无法登陆的问题</h3>
<p>在较新版本的 OpenSSH 中，使用 RSA 密钥登陆时可能会产生 <code>userauth_pubkey: signature algorithm ssh-rsa not in pubkeyacceptedalgorithms</code> 的登陆错误日志，这是因为新版本的 OpenSSH 对一些不安全算法进行了禁用，可以通过修改配置解决。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 修改配置</span>
</span></span><span class="line"><span class="cl">$ cat /etc/ssh/sshd_config
</span></span><span class="line"><span class="cl">PubkeyAcceptedAlgorithms +ssh-rsa
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 通过测试命令确认无误后就可以重启服务</span>
</span></span><span class="line"><span class="cl">$ sshd -T <span class="p">|</span> grep pubkeyacceptedalgorithms
</span></span></code></pre></div><h3 id="启用-sftp">启用 SFTP</h3>
<p>sshd 服务默认就会启动 SFTP 服务，这里主要是对某些用户做一些额外的 SFTP 适配。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 增加 sftp 用户并修改密码</span>
</span></span><span class="line"><span class="cl">$ useradd sftp -s /sbin/nologin -M
</span></span><span class="line"><span class="cl">$ passwd sftp
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 修改 sshd 服务的配置</span>
</span></span><span class="line"><span class="cl">$ cat /etc/ssh/sshd_config
</span></span><span class="line"><span class="cl">Subsystem sftp internal-sftp
</span></span><span class="line"><span class="cl">Match User sftp
</span></span><span class="line"><span class="cl">ForceCommand internal-sftp
</span></span><span class="line"><span class="cl">X11Forwarding no
</span></span><span class="line"><span class="cl">AllowTcpForwarding no
</span></span><span class="line"><span class="cl">PasswordAuthentication yes
</span></span><span class="line"><span class="cl">ChrootDirectory /data/sftp
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 创建 sftp 数据目录</span>
</span></span><span class="line"><span class="cl">$ mkdir -p /data/sftp
</span></span><span class="line"><span class="cl">$ chown root:root /data/sftp
</span></span><span class="line"><span class="cl">$ mkdir -p /data/sftp/sftp
</span></span><span class="line"><span class="cl">$ chown sftp:sftp /data/sftp/sftp
</span></span><span class="line"><span class="cl">$ chmod <span class="m">750</span> /data/sftp/sftp
</span></span><span class="line"><span class="cl"><span class="c1"># 使用 sftp 用户登陆后会被限制在 /data/sftp 中，并且只能修改 /data/sftp/sftp 下的文件</span>
</span></span></code></pre></div><h2 id="debian-用户安全加固">Debian 用户安全加固</h2>
<h3 id="增加用户登陆会话超时时间">增加用户登陆会话超时时间</h3>
<p>设置用户登陆会话的超时时间为 15 分钟，到达对应的空闲时间后会自动退出会话。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 追加环境变量到 /etc/profile.d/session_timeout.sh 文件中</span>
</span></span><span class="line"><span class="cl">$ cat /etc/profile.d/session_timeout.sh
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">TMOUT</span><span class="o">=</span><span class="m">900</span>
</span></span><span class="line"><span class="cl"><span class="nb">readonly</span> TMOUT
</span></span></code></pre></div><h3 id="增加用户密码过期时间">增加用户密码过期时间</h3>
<p>系统默认的用户密码过期时间等同于永不过期，可以参考以下命令修改，这里的命令应该也适用于其他发行版。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 检查当前用户密码过期时间</span>
</span></span><span class="line"><span class="cl">$ grep PASS_MAX_DAYS /etc/login.defs
</span></span><span class="line"><span class="cl"><span class="c1"># PASS_MAX_DAYS Maximum number of days a password may be used.</span>
</span></span><span class="line"><span class="cl">PASS_MAX_DAYS <span class="m">99999</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 将默认的过期时间修改为 7 天</span>
</span></span><span class="line"><span class="cl">$ sed -i <span class="s1">&#39;s/PASS_MAX_DAYS.*/PASS_MAX_DAYS\t7/&#39;</span> /etc/login.defs
</span></span></code></pre></div><h3 id="增加密码复杂度要求">增加密码复杂度要求</h3>
<p>密码复杂度需要符合一定的安全标准，可以大致参考以下要求：</p>
<ul>
<li>密码长度大于等于 12 个字符。</li>
<li>密码至少包含大写字母，小写字母，数字字符。</li>
<li>不得与之前 5 次使用过的密码相同。</li>
</ul>
<p>一般借助 pam 模块来实现密码复杂度限制。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 安装 pwquality module</span>
</span></span><span class="line"><span class="cl">$ apt install libpam-pwquality
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 修改 pwquality 配置文件</span>
</span></span><span class="line"><span class="cl">$ cat /etc/security/pwquality.conf
</span></span><span class="line"><span class="cl"><span class="nv">minlen</span> <span class="o">=</span> <span class="m">12</span>
</span></span><span class="line"><span class="cl"><span class="nv">dcredit</span> <span class="o">=</span> -1
</span></span><span class="line"><span class="cl"><span class="nv">ucredit</span> <span class="o">=</span> -1
</span></span><span class="line"><span class="cl"><span class="nv">lcredit</span> <span class="o">=</span> -1
</span></span><span class="line"><span class="cl"><span class="nv">retry</span> <span class="o">=</span> <span class="m">3</span>
</span></span><span class="line"><span class="cl">enforce_for_root
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 增加 pwhistory 配置项</span>
</span></span><span class="line"><span class="cl">$ cat /usr/share/pam-configs/pwhistory
</span></span><span class="line"><span class="cl">Name: Pwhistory
</span></span><span class="line"><span class="cl">Default: yes
</span></span><span class="line"><span class="cl">Priority: <span class="m">1024</span>
</span></span><span class="line"><span class="cl">Password-Type: Primary
</span></span><span class="line"><span class="cl">Password:
</span></span><span class="line"><span class="cl">  required  pam_pwhistory.so enforce_for_root use_authtok <span class="nv">remember</span><span class="o">=</span><span class="m">5</span>
</span></span><span class="line"><span class="cl">Password-Initial:
</span></span><span class="line"><span class="cl">  required  pam_pwhistory.so enforce_for_root use_authtok <span class="nv">remember</span><span class="o">=</span><span class="m">5</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 修改 pam 配置，勾选已经创建的 Pwhistory 然后保存</span>
</span></span><span class="line"><span class="cl">$ pam-auth-update
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 检查配置是否生效</span>
</span></span><span class="line"><span class="cl">$ cat /etc/pam.d/common-password
</span></span><span class="line"><span class="cl"><span class="c1"># pam_pwquality.so 由 libpam-pwquality 提供，安装后会自动出现在配置文件中</span>
</span></span><span class="line"><span class="cl"><span class="c1"># pam_pwhistory.so 由 libpam-modules 提供，不需要额外安装软件，但需要在添加默认配置项后，使用 pam-auth-update 进行配置</span>
</span></span></code></pre></div><h3 id="增加-bash_history-时间戳">增加 bash_history 时间戳</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 追加环境变量到 /etc/profile.d/history_timestamp.sh 文件中</span>
</span></span><span class="line"><span class="cl">$ cat /etc/profile.d/history_timestamp.sh
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">HISTTIMEFORMAT</span><span class="o">=</span><span class="s2">&#34;%F %T `whoami` &#34;</span>
</span></span></code></pre></div><h2 id="修改-linux-进程数限制">修改 Linux 进程数限制</h2>
<p>用户直接执行 <code>ulimit -a</code> 就可以看到对应的自身受到的进程相关限制，可以通过修改 <code>/etc/security/limits.conf</code> 来改变这个设置。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ cat /etc/security/limits.conf
</span></span><span class="line"><span class="cl"><span class="c1"># nproc 代表进程数量限制</span>
</span></span><span class="line"><span class="cl"><span class="c1"># nofile 代表打开文件数量限制</span>
</span></span><span class="line"><span class="cl">user soft nproc <span class="m">65536</span>
</span></span><span class="line"><span class="cl">user hard nproc <span class="m">65536</span>
</span></span><span class="line"><span class="cl">user soft nofile <span class="m">65536</span>
</span></span><span class="line"><span class="cl">user hard nofile <span class="m">65536</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># /etc/security/limits.conf 修改后需要确认 pam_limits.so 动态库正常加载</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 确认以下两个配置存在 required pam_limits.so</span>
</span></span><span class="line"><span class="cl">$ cat /etc/pam.d/sshd
</span></span><span class="line"><span class="cl">$ cat /etc/pam.d/login
</span></span><span class="line"><span class="cl">session required pam_limits.so
</span></span></code></pre></div><h2 id="启用时间同步服务">启用时间同步服务</h2>
<p>Debian 一般会默认启用这个服务，这里的主要是为了修改 ntp 服务器地址。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ vi /etc/systemd/timesyncd.conf
</span></span><span class="line"><span class="cl"><span class="o">[</span>Time<span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="nv">NTP</span><span class="o">=</span>ntp.aliyun.com ntp1.aliyun.com
</span></span><span class="line"><span class="cl"><span class="nv">FallbackNTP</span><span class="o">=</span>0.debian.pool.ntp.org 1.debian.pool.ntp.org 2.debian.pool.ntp.org 3.debian.pool.ntp.org
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 配置检查</span>
</span></span><span class="line"><span class="cl">$ timedatectl show-timesync --all
</span></span><span class="line"><span class="cl"><span class="c1"># 重启服务</span>
</span></span><span class="line"><span class="cl">$ systemctl restart systemd-timesyncd.service
</span></span></code></pre></div><h2 id="通过-dpkg-管理-deb-软件包">通过 dpkg 管理 deb 软件包</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 查询系统已经安装的 deb 软件包，对标 redhat 系列的 rpm -qa</span>
</span></span><span class="line"><span class="cl">dpkg -l
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 查询 deb 软件包安装的所有文件，对标 redhat 系列的 rpm -ql &#34;package_name&#34;</span>
</span></span><span class="line"><span class="cl">dpkg -L <span class="s2">&#34;package_name&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 查询文件的 deb 软件包归属，对标 redhat 系列的 rpm -qf &#34;filename&#34;</span>
</span></span><span class="line"><span class="cl">dpkg -S <span class="s2">&#34;filename&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 不执行安装，只下载 deb 软件包，会默认下载到 apt 的缓存目录</span>
</span></span><span class="line"><span class="cl">apt install --download-only <span class="s2">&#34;package_name&#34;</span>
</span></span><span class="line"><span class="cl">ls /var/cache/apt/archives
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 不执行安装，直接解压 deb 软件包，可以自由指定解压目录</span>
</span></span><span class="line"><span class="cl">dpkg -x <span class="s2">&#34;package_name&#34;</span> /tmp/deb
</span></span></code></pre></div><h2 id="gpg-key-的导出和导入">GPG KEY 的导出和导入</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">apt update
</span></span><span class="line"><span class="cl">apt install gpg gpg-agent
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 检查现有的 gpg key</span>
</span></span><span class="line"><span class="cl">gpg --list-signatures
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 获取 keyid 后执行导出，导出私钥时需要对应的密码</span>
</span></span><span class="line"><span class="cl">gpg --output pub.gpg --armor --export <span class="s2">&#34;keyid&#34;</span>
</span></span><span class="line"><span class="cl">gpg --output pri.gpg --armor --export-secret-key <span class="s2">&#34;keyid&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 执行导入</span>
</span></span><span class="line"><span class="cl">gpg --import pub.gpg
</span></span><span class="line"><span class="cl">gpg --allow-secret-key-import --import pri.gpg
</span></span></code></pre></div></article>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>
</div>
<script type="application/javascript" src='https://yuweizzz.github.io/js/toc.js'></script>
<link rel="stylesheet" href='https://yuweizzz.github.io/css/toc.css' />

  
</div>

  <div class="footer container-xl width-full p-responsive">
  <div
    class="position-relative d-flex flex-row-reverse flex-lg-row flex-wrap flex-lg-nowrap flex-justify-center flex-lg-justify-between flex-sm-items-center pt-6 pb-2 mt-6 f6 text-gray border-top border-gray-light ">
    <a aria-label="Homepage" title="GitHub" class="footer-octicon d-none d-lg-block mr-lg-4" href="https://yuweizzz.github.io/">
      <svg height="24" class="octicon octicon-mark-github" viewBox="0 0 16 16" version="1.1" width="24">
        <path fill-rule="evenodd"
          d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z">
        </path>
      </svg>
    </a>
    <ul class="list-style-none d-flex flex-wrap col-12 flex-justify-center flex-lg-justify-between mb-2 mb-lg-0">
      
      <li class="mr-3 mr-lg-0">Theme by <a href='https://github.com/MeiK2333/github-style'>github-style</a></li>
      
      <li class="mr-3 mr-lg-0">GitHub and the Invertocat logo are trademarks of <a href="https://github.com/">GitHub, Inc.</a></li>
    </ul>
  </div>
  <div class="d-flex flex-justify-center pb-6">
    <span class="f6 text-gray-light"></span>
  </div>


</div>

</body>

<script type="application/javascript" src="https://yuweizzz.github.io/js/github-style.js"></script>





<script src="https://cdn.jsdelivr.net/npm/fuse.js/dist/fuse.min.js"></script>
<script type="application/javascript" src='https://yuweizzz.github.io/js/search.js'></script>



</html>