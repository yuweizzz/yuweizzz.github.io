<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <script type="application/javascript" src='https://yuweizzz.github.io/js/theme-mode.js'></script>
    <link rel="stylesheet" href='https://yuweizzz.github.io/css/frameworks.min.css' />
    <link rel="stylesheet" href='https://yuweizzz.github.io/css/github.min.css' />
    <link rel="stylesheet" href='https://yuweizzz.github.io/css/github-style.css' />
    <link rel="stylesheet" href='https://yuweizzz.github.io/css/light.css' />
    <link rel="stylesheet" href='https://yuweizzz.github.io/css/dark.css' />
    <link rel="stylesheet" href='https://yuweizzz.github.io/css/syntax.css' />
    <title>Lua 学习笔记 - Wei&#39;s blog</title>
    
    <link rel="icon" type="image/x-icon" href='/images/favicon.svg'>
    
    <meta name="theme-color" content="#1e2327">

    
    <meta name="description"
  content="这篇笔记用来记录一些 Lua 的相关知识。
" />
<meta name="keywords"
  content='blog, google analytics' />
<meta name="robots" content="noodp" />
<link rel="canonical" href="https://yuweizzz.github.io/post/study_notes_about_lua/" />


<meta name="twitter:card" content="summary" />
<meta name="twitter:title" content="Lua 学习笔记 - Wei&#39;s blog" />
<meta name="twitter:description"
  content="这篇笔记用来记录一些 Lua 的相关知识。
" />
<meta name="twitter:site" content="https://yuweizzz.github.io/" />
<meta name="twitter:creator" content="" />
<meta name="twitter:image"
  content="https://yuweizzz.github.io/">


<meta property="og:type" content="article" />
<meta property="og:title" content="Lua 学习笔记 - Wei&#39;s blog">
<meta property="og:description"
  content="这篇笔记用来记录一些 Lua 的相关知识。
" />
<meta property="og:url" content="https://yuweizzz.github.io/post/study_notes_about_lua/" />
<meta property="og:site_name" content="Lua 学习笔记" />
<meta property="og:image"
  content="https://yuweizzz.github.io/">
<meta property="og:image:width" content="2048">
<meta property="og:image:height" content="1024">

<meta property="article:published_time" content="2022-09-04 19:44:45 &#43;0000 UTC" />











  
    
      <script async src="https://www.googletagmanager.com/gtag/js?id=G-RFSQDKSFR1"></script>
      <script>
        var doNotTrack = false;
        if ( false ) {
          var dnt = (navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack);
          var doNotTrack = (dnt == "1" || dnt == "yes");
        }
        if (!doNotTrack) {
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'G-RFSQDKSFR1');
        }
      </script>
    
  




</head>

<body>
  <div style="position: relative">
  <header class="Header js-details-container Details px-3 px-md-4 px-lg-5 flex-wrap flex-md-nowrap open Details--on">
    <div class="Header-item mobile-none" style="margin-top: -4px; margin-bottom: -4px;">
      <a class="Header-link" href="https://yuweizzz.github.io/">
        <img class="octicon" height="32" width="32" src="/images/github-mark-white.png">
      </a>
    </div>
    <div class="Header-item d-md-none">
      <button class="Header-link btn-link js-details-target" type="button"
        onclick="document.querySelector('#header-search').style.display = document.querySelector('#header-search').style.display == 'none'? 'block': 'none'">
        <svg height="24" class="octicon octicon-three-bars" viewBox="0 0 16 16" version="1.1" width="24">
          <path fill-rule="evenodd" d="M1 2.75A.75.75 0 011.75 2h12.5a.75.75 0 110 1.5H1.75A.75.75 0 011 2.75zm0 5A.75.75 0 011.75 7h12.5a.75.75 0 110 1.5H1.75A.75.75 0 011 7.75zM1.75 12a.75.75 0 100 1.5h12.5a.75.75 0 100-1.5H1.75z">
          </path>
        </svg>
      </button>
    </div>
    <div style="display: none;" id="header-search"
      class="Header-item Header-item--full flex-column flex-md-row width-full flex-order-2 flex-md-order-none mr-0 mr-md-3 mt-3 mt-md-0 Details-content--hidden-not-important d-md-flex">
      <div
        class="Header-search header-search flex-auto js-site-search position-relative flex-self-stretch flex-md-self-auto mb-3 mb-md-0 mr-0 mr-md-3 scoped-search site-scoped-search js-jump-to">
        <div class="position-relative">
          
          <form target="_blank" id="search-form" action="" accept-charset="UTF-8" method="get"
            autocomplete="off">
            <label
              class="Header-search-label form-control input-sm header-search-wrapper p-0 js-chromeless-input-container header-search-wrapper-jump-to position-relative d-flex flex-justify-between flex-items-center">
              <input type="text"
                class="Header-search-input form-control input-sm header-search-input jump-to-field js-jump-to-field js-site-search-focus js-site-search-field is-clearable"
                name="q" value="" placeholder="Search" autocomplete="off">
            </label>
          </form>
          
        </div>
      </div>
    </div>

    <div class="Header-item Header-item--full flex-justify-center d-md-none position-relative">
      <a class="Header-link " href="https://yuweizzz.github.io/">
        <img class="octicon octicon-mark-github v-align-middle" height="32" width="32" src="/images/github-mark-white.png">
      </a>
    </div>
    <div class="Header-item" style="margin-right: 0;">
      <a href="javascript:void(0)" class="Header-link no-select" onclick="switchTheme()">
        <svg style="fill: var(--color-profile-color-modes-toggle-moon);" class="no-select" viewBox="0 0 16 16"
          version="1.1" width="16" height="16">
          <path fill-rule="evenodd" clip-rule="evenodd"
            d="M4.52208 7.71754C7.5782 7.71754 10.0557 5.24006 10.0557 2.18394C10.0557 1.93498 10.0392 1.68986 10.0074 1.44961C9.95801 1.07727 10.3495 0.771159 10.6474 0.99992C12.1153 2.12716 13.0615 3.89999 13.0615 5.89383C13.0615 9.29958 10.3006 12.0605 6.89485 12.0605C3.95334 12.0605 1.49286 10.001 0.876728 7.24527C0.794841 6.87902 1.23668 6.65289 1.55321 6.85451C2.41106 7.40095 3.4296 7.71754 4.52208 7.71754Z">
          </path>
        </svg>
      </a>
    </div>
  </header>
</div>

  <div id="search-result" class="container-lg px-3 new-discussion-timeline" style="display: none;">
</div>

  
<div class="application-main">
  <div>
  <main>
    <div class="gisthead pagehead bg-gray-light pb-0 pt-3 mb-4">
      <div class="px-0">
        <div class="mb-3 d-flex px-3 px-md-3 px-lg-5">
          <div class="flex-auto min-width-0 width-fit mr-3">
            <div class="d-flex">
              <div class="d-none d-md-block">
                <a class="avatar mr-2 flex-shrink-0" href="https://yuweizzz.github.io/">
                  <img class=" avatar-user"
                    src="https://yuweizzz.github.io/images/avatar.png"
                    width="32" height="32"></a>
              </div>
              <div class="d-flex flex-column">
                <h1 class="break-word f3 text-normal mb-md-0 mb-1">
                  <span class="author">
                    <a href="https://yuweizzz.github.io/">Wei</a>
                  </span>
                  <span class="path-divider">/</span>
                  <strong class="css-truncate css-truncate-target mr-1" style="max-width: 410px">
                    <a href="https://yuweizzz.github.io/post/study_notes_about_lua/">Lua 学习笔记</a>
                  </strong>
                </h1>
                <div class="note m-0">
                  Created <relative-time datetime="Sun, 04 Sep 2022 19:44:45 &#43;0000"
                    class="no-wrap">
                    Sun, 04 Sep 2022 19:44:45 &#43;0000</relative-time>

                  
                  <span class="file-info-divider"></span>
                  Modified <relative-time datetime="Sat, 12 Oct 2024 07:20:01 &#43;0000"
                    class="no-wrap">
                    Sat, 12 Oct 2024 07:20:01 &#43;0000</relative-time>
                  
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="container-lg px-3 new-discussion-timeline">
      <div class="repository-content gist-content">
        <div>
          <div class="js-gist-file-update-container js-task-list-container file-box">
            <div id="file-pytest" class="file my-2">
              <div id="post-header" class="file-header d-flex flex-md-items-center flex-items-start sticky-header" style="z-index: 2">
                <div class="file-info d-flex flex-md-items-center flex-items-start flex-order-1 flex-auto">
                  <div class="text-mono f6 flex-auto pr-3 flex-order-2 flex-md-order-1 mt-2 mt-md-0">
                    
                    <summary id="toc-toggle" onclick="clickToc()" class="btn btn-octicon m-0 mr-2 p-2">
                      <svg aria-hidden="true" viewBox="0 0 16 16" height="16" width="16" class="octicon octicon-list-unordered">
                        <path fill-rule="evenodd" d="M2 4a1 1 0 100-2 1 1 0 000 2zm3.75-1.5a.75.75 0 000 1.5h8.5a.75.75 0 000-1.5h-8.5zm0 5a.75.75 0 000 1.5h8.5a.75.75 0 000-1.5h-8.5zm0 5a.75.75 0 000 1.5h8.5a.75.75 0 000-1.5h-8.5zM3 8a1 1 0 11-2 0 1 1 0 012 0zm-1 6a1 1 0 100-2 1 1 0 000 2z"></path>
                      </svg>
                    </summary>
                    <details-menu class="SelectMenu" id="toc-details" style="display: none;">
                      <div class="SelectMenu-modal rounded-3 mt-1" style="max-height: 340px;">
                        <div class="SelectMenu-list SelectMenu-list--borderless p-2" style="overscroll-behavior: contain;" id="toc-list">
                        </div>
                      </div>
                    </details-menu>
                      1710 Words
                    

                  </div>
                  <div class="file-actions flex-order-2 pt-0">
                    
                    
                    <a class="muted-link mr-3" href="/tags/lua">
                      <svg class="octicon octicon-tag" viewBox="0 0 16 16" version="1.1" width="16" height="16">
                        <path fill-rule="evenodd"
                          d="M2.5 7.775V2.75a.25.25 0 01.25-.25h5.025a.25.25 0 01.177.073l6.25 6.25a.25.25 0 010 .354l-5.025 5.025a.25.25 0 01-.354 0l-6.25-6.25a.25.25 0 01-.073-.177zm-1.5 0V2.75C1 1.784 1.784 1 2.75 1h5.025c.464 0 .91.184 1.238.513l6.25 6.25a1.75 1.75 0 010 2.474l-5.026 5.026a1.75 1.75 0 01-2.474 0l-6.25-6.25A1.75 1.75 0 011 7.775zM6 5a1 1 0 100 2 1 1 0 000-2z">
                        </path>
                      </svg>
                      Lua
                    </a>
                    
                    <a class="muted-link mr-3" href="/tags/luarocks">
                      <svg class="octicon octicon-tag" viewBox="0 0 16 16" version="1.1" width="16" height="16">
                        <path fill-rule="evenodd"
                          d="M2.5 7.775V2.75a.25.25 0 01.25-.25h5.025a.25.25 0 01.177.073l6.25 6.25a.25.25 0 010 .354l-5.025 5.025a.25.25 0 01-.354 0l-6.25-6.25a.25.25 0 01-.073-.177zm-1.5 0V2.75C1 1.784 1.784 1 2.75 1h5.025c.464 0 .91.184 1.238.513l6.25 6.25a1.75 1.75 0 010 2.474l-5.026 5.026a1.75 1.75 0 01-2.474 0l-6.25-6.25A1.75 1.75 0 011 7.775zM6 5a1 1 0 100 2 1 1 0 000-2z">
                        </path>
                      </svg>
                      Luarocks
                    </a>
                    
                    
                  </div>
                </div>
              </div>


              <div class="Box-body px-5 pb-5" style="z-index: 1">
                <article class="markdown-body entry-content container-lg"><p>这篇笔记用来记录一些 Lua 的相关知识。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                                       <span class="o">(</span>@@<span class="o">)</span> <span class="o">(</span>  <span class="o">)</span> <span class="o">(</span>@<span class="o">)</span>  <span class="o">(</span> <span class="o">)</span>  @@    <span class="o">()</span>    @     O     @     O      @
</span></span><span class="line"><span class="cl">                                  <span class="o">(</span>   <span class="o">)</span>
</span></span><span class="line"><span class="cl">                              <span class="o">(</span>@@@@<span class="o">)</span>
</span></span><span class="line"><span class="cl">                           <span class="o">(</span>    <span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                         <span class="o">(</span>@@@<span class="o">)</span>
</span></span><span class="line"><span class="cl">                       <span class="o">====</span>        ________                ___________
</span></span><span class="line"><span class="cl">                   _D _<span class="p">|</span>  <span class="p">|</span>_______/        <span class="se">\_</span>_I_I_____<span class="o">===</span>__<span class="p">|</span>_________<span class="p">|</span>
</span></span><span class="line"><span class="cl">                    <span class="p">|</span><span class="o">(</span>_<span class="o">)</span>---  <span class="p">|</span>   H<span class="se">\_</span>_______/ <span class="p">|</span>   <span class="p">|</span>        <span class="o">=</span><span class="p">|</span>___ ___<span class="p">|</span>      _________________
</span></span><span class="line"><span class="cl">                    /     <span class="p">|</span>  <span class="p">|</span>   H  <span class="p">|</span>  <span class="p">|</span>     <span class="p">|</span>   <span class="p">|</span>         <span class="o">||</span>_<span class="p">|</span> <span class="p">|</span>_<span class="o">||</span>     _<span class="p">|</span>                <span class="se">\_</span>____A
</span></span><span class="line"><span class="cl">                   <span class="p">|</span>      <span class="p">|</span>  <span class="p">|</span>   H  <span class="p">|</span>__--------------------<span class="p">|</span> <span class="o">[</span>___<span class="o">]</span> <span class="p">|</span>   <span class="o">=</span><span class="p">|</span>                        <span class="p">|</span>
</span></span><span class="line"><span class="cl">                   <span class="p">|</span> ________<span class="p">|</span>___H__/__<span class="p">|</span>_____/<span class="o">[][]</span>~<span class="se">\_</span>______<span class="p">|</span>       <span class="p">|</span>   -<span class="p">|</span>                        <span class="p">|</span>
</span></span><span class="line"><span class="cl">                   <span class="p">|</span>/ <span class="p">|</span>   <span class="p">|</span>-----------I_____I <span class="o">[][]</span> <span class="o">[]</span>  D   <span class="p">|</span><span class="o">=======</span><span class="p">|</span>____<span class="p">|</span>________________________<span class="p">|</span>_
</span></span><span class="line"><span class="cl">                 __/ <span class="o">=</span><span class="p">|</span> o <span class="p">|</span><span class="o">=</span>-~O<span class="o">=====</span><span class="nv">O</span><span class="o">=====</span><span class="nv">O</span><span class="o">=====</span>O<span class="se">\ </span>____Y___________<span class="p">|</span>__<span class="p">|</span>__________________________<span class="p">|</span>_
</span></span><span class="line"><span class="cl">                  <span class="p">|</span>/-<span class="o">=</span><span class="p">|</span>___<span class="p">|</span><span class="o">=</span>    <span class="o">||</span>    <span class="o">||</span>    <span class="o">||</span>    <span class="p">|</span>_____/~<span class="se">\_</span>__/          <span class="p">|</span>_D__D__D_<span class="p">|</span>  <span class="p">|</span>_D__D__D_<span class="p">|</span>
</span></span><span class="line"><span class="cl">                   <span class="se">\_</span>/      <span class="se">\_</span>_/  <span class="se">\_</span>_/  <span class="se">\_</span>_/  <span class="se">\_</span>_/      <span class="se">\_</span>/               <span class="se">\_</span>/   <span class="se">\_</span>/    <span class="se">\_</span>/   <span class="se">\_</span>/
</span></span></code></pre></div><p>lua 是一门高效的，易于嵌入其他应用程序的轻量级脚本语言。 lua 的高效快速主要是由于 lua 本身的底层设计以及非常高效的 Lua 解释器。这里主要会记录一些 lua 入门学习时一些遇到的问题。</p>
<h2 id="lua-string-处理">Lua String 处理</h2>
<p>lua 的 string 类型数据是不可改变的，大部分情况下要依靠 string 库来处理。</p>
<h3 id="string-拼接">string 拼接</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="line"><span class="cl"><span class="n">strings_a</span> <span class="o">=</span> <span class="s2">&#34;a&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">strings_b</span> <span class="o">=</span> <span class="s2">&#34;b&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">strings_c</span> <span class="o">=</span> <span class="s2">&#34;c&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">print</span><span class="p">(</span><span class="n">strings_a</span> <span class="o">..</span> <span class="n">strings_b</span> <span class="o">..</span> <span class="n">strings_c</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">-- output:</span>
</span></span><span class="line"><span class="cl"><span class="c1">-- abc</span>
</span></span></code></pre></div><h3 id="string-替换和截取">string 替换和截取</h3>
<p>一般使用 <code>string.gsub</code> 来替换字符串内容，而 <code>string.sub</code> 是用来截取字符串。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="line"><span class="cl"><span class="n">strings</span> <span class="o">=</span> <span class="s2">&#34;abcde&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">print</span><span class="p">(</span><span class="n">string.gsub</span><span class="p">(</span><span class="n">strings</span><span class="p">,</span> <span class="s2">&#34;a&#34;</span><span class="p">,</span> <span class="s2">&#34;z&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="c1">-- output:</span>
</span></span><span class="line"><span class="cl"><span class="c1">-- zbcde	1</span>
</span></span><span class="line"><span class="cl"><span class="c1">-- 返回值分别是 gsub 执行后的字符串和具体发生替换的次数，可以根据第二个参数判断是否已经执行替换</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">strings</span> <span class="o">=</span> <span class="s2">&#34;aaaae&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">print</span><span class="p">(</span><span class="n">string.gsub</span><span class="p">(</span><span class="n">strings</span><span class="p">,</span> <span class="s2">&#34;a&#34;</span><span class="p">,</span> <span class="s2">&#34;z&#34;</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="c1">-- output:</span>
</span></span><span class="line"><span class="cl"><span class="c1">-- zzaae	2</span>
</span></span><span class="line"><span class="cl"><span class="c1">-- 可以通过传进第四个参数限制替换次数</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">strings</span> <span class="o">=</span> <span class="s2">&#34;abcde&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">print</span><span class="p">(</span><span class="n">string.sub</span><span class="p">(</span><span class="n">strings</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="c1">-- output:</span>
</span></span><span class="line"><span class="cl"><span class="c1">-- cde</span>
</span></span><span class="line"><span class="cl"><span class="c1">-- 从给定位置开始截取到最后一个字符</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">strings</span> <span class="o">=</span> <span class="s2">&#34;abcde&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">print</span><span class="p">(</span><span class="n">string.sub</span><span class="p">(</span><span class="n">strings</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="c1">-- output:</span>
</span></span><span class="line"><span class="cl"><span class="c1">-- cd</span>
</span></span><span class="line"><span class="cl"><span class="c1">-- 截取起止位置都确定的字符串</span>
</span></span></code></pre></div><h3 id="string-find">string find</h3>
<p><code>string.find</code> 可以用来进行字符串搜索，需要注意的用法是带有特殊字符时，应该指定为 plain 模式。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="line"><span class="cl"><span class="c1">-- 普通字符串搜索</span>
</span></span><span class="line"><span class="cl"><span class="n">strings</span> <span class="o">=</span> <span class="s2">&#34;abcde&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">print</span><span class="p">(</span><span class="n">string.find</span><span class="p">(</span><span class="n">strings</span><span class="p">,</span> <span class="s2">&#34;a&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="c1">-- output:</span>
</span></span><span class="line"><span class="cl"><span class="c1">-- 1	1</span>
</span></span><span class="line"><span class="cl"><span class="c1">-- 成功则返回匹配字符的起止位置索引，失败则返回 nil</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">-- 带有特殊字符的字符串搜索</span>
</span></span><span class="line"><span class="cl"><span class="n">strings</span> <span class="o">=</span> <span class="s2">&#34;abcde.*&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">print</span><span class="p">(</span><span class="n">string.find</span><span class="p">(</span><span class="n">strings</span><span class="p">,</span> <span class="s2">&#34;.*&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="c1">-- output:</span>
</span></span><span class="line"><span class="cl"><span class="c1">-- 1	7</span>
</span></span><span class="line"><span class="cl"><span class="c1">-- 默认以正则模式进行搜索</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">print</span><span class="p">(</span><span class="n">string.find</span><span class="p">(</span><span class="n">strings</span><span class="p">,</span> <span class="s2">&#34;.*&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="kc">true</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="c1">-- output:</span>
</span></span><span class="line"><span class="cl"><span class="c1">-- 6	7</span>
</span></span><span class="line"><span class="cl"><span class="c1">-- 指定为 plain 模式，不再以正则模式进行搜索</span>
</span></span></code></pre></div><h3 id="string-match">string match</h3>
<p>匹配取值有 match 和 gmatch 两种，前者用于直接匹配结果，后者可以返回迭代器函数，用于循环场景。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="line"><span class="cl"><span class="n">strings</span> <span class="o">=</span> <span class="s2">&#34;  1 + 1  =2&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">print</span><span class="p">(</span><span class="n">string.match</span><span class="p">(</span><span class="n">strings</span><span class="p">,</span> <span class="s2">&#34;^%s*(.-)%s*=.*&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="c1">-- output:</span>
</span></span><span class="line"><span class="cl"><span class="c1">-- 1 + 1</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">print</span><span class="p">(</span><span class="n">string.match</span><span class="p">(</span><span class="n">strings</span><span class="p">,</span> <span class="s2">&#34;^%s*.-%s*=(.*)&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="c1">-- output:</span>
</span></span><span class="line"><span class="cl"><span class="c1">-- 2</span>
</span></span><span class="line"><span class="cl"><span class="c1">-- 匹配成功则返回整个匹配的字符串，由于使用了括号进行子模式匹配，所以只返回了匹配部分，其中 .- 代表任意字符的非贪婪匹配</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">iterator</span> <span class="o">=</span> <span class="n">string.gmatch</span><span class="p">(</span><span class="n">strings</span><span class="p">,</span> <span class="s2">&#34;%d&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="kr">for</span> <span class="n">each</span> <span class="kr">in</span> <span class="n">iterator</span> <span class="kr">do</span> <span class="n">print</span><span class="p">(</span><span class="n">each</span><span class="p">)</span> <span class="kr">end</span>
</span></span><span class="line"><span class="cl"><span class="c1">-- output:</span>
</span></span><span class="line"><span class="cl"><span class="c1">-- 1</span>
</span></span><span class="line"><span class="cl"><span class="c1">-- 1</span>
</span></span><span class="line"><span class="cl"><span class="c1">-- 2</span>
</span></span><span class="line"><span class="cl"><span class="c1">-- 匹配成功则可以在每次循环中得到对应的匹配部分</span>
</span></span></code></pre></div><h2 id="lua-table">Lua Table</h2>
<p>lua table 是一种异于其他编程语言的数据类型，它是动态增长的字典类容器，同时具有数组的特性，如果仔细研究它的内部结构，可以发现它是有两者混合构成的。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="line"><span class="cl"><span class="n">t</span> <span class="o">=</span> <span class="p">{</span><span class="n">a</span><span class="o">=</span><span class="s2">&#34;A&#34;</span><span class="p">,</span> <span class="s2">&#34;B&#34;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">&#34;C&#34;</span><span class="p">,</span> <span class="n">D</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="n">print</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>    <span class="c1">-- output: nil</span>
</span></span><span class="line"><span class="cl"><span class="n">print</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="s2">&#34;a&#34;</span><span class="p">])</span>  <span class="c1">-- output: A</span>
</span></span><span class="line"><span class="cl"><span class="n">print</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>    <span class="c1">-- output: B</span>
</span></span><span class="line"><span class="cl"><span class="n">print</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="s2">&#34;c&#34;</span><span class="p">])</span>  <span class="c1">-- output: C</span>
</span></span><span class="line"><span class="cl"><span class="n">print</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>    <span class="c1">-- output: nil</span>
</span></span><span class="line"><span class="cl"><span class="n">print</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>    <span class="c1">-- output: nil</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">-- D 这个值是测试时疏漏了引号产生的错误，它会认为是一个值为 nil 的变量，相当于空洞</span>
</span></span></code></pre></div><p>通过这个例子可以简单看出它们的混合特点，键值对和数组是互相独立的，需要使用明确的键取对应的值，数组值则使用数字索引，并且索引是从 1 开始而不是 0 ，要注意这里只是为了弄清楚它们的特性才使用了混合结构，实际中基本不会这样使用。</p>
<h2 id="lua-模块和-luarocks">Lua 模块和 Luarocks</h2>
<p>常规的 lua 脚本需要依靠两个重要变量 <code>package.path</code> 和 <code>package.cpath</code> 来获取一些运行模块信息，它们主要区别在于模块是由 lua 语言实现还是由 c 语言实现。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ cat p.lua
</span></span><span class="line"><span class="cl">print<span class="o">(</span>package.path<span class="o">)</span>
</span></span><span class="line"><span class="cl">print<span class="o">(</span>package.cpath<span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ lua p.lua
</span></span><span class="line"><span class="cl">./?.lua<span class="p">;</span>/usr/share/lua/5.1/?.lua<span class="p">;</span>/usr/share/lua/5.1/?/init.lua<span class="p">;</span>/usr/lib64/lua/5.1/?.lua<span class="p">;</span>/usr/lib64/lua/5.1/?/init.lua
</span></span><span class="line"><span class="cl">./?.so<span class="p">;</span>/usr/lib64/lua/5.1/?.so<span class="p">;</span>/usr/lib64/lua/5.1/loadall.so
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 可以通过指定环境变量 LUA_PATH 和 LUA_CPATH 来改变这两个值，其中 ;; 的第二个 ; 会被替换为原有的默认值</span>
</span></span><span class="line"><span class="cl">$ <span class="nv">LUA_PATH</span><span class="o">=</span><span class="s2">&#34;/tmp/?.lua;;&#34;</span> <span class="nv">LUA_CPATH</span><span class="o">=</span><span class="s2">&#34;/tmp/?.so;;&#34;</span> lua p.lua
</span></span><span class="line"><span class="cl">/tmp/?.lua<span class="p">;</span>./?.lua<span class="p">;</span>/usr/share/lua/5.1/?.lua<span class="p">;</span>/usr/share/lua/5.1/?/init.lua<span class="p">;</span>/usr/lib64/lua/5.1/?.lua<span class="p">;</span>/usr/lib64/lua/5.1/?/init.lua<span class="p">;</span>
</span></span><span class="line"><span class="cl">/tmp/?.so<span class="p">;</span>./?.so<span class="p">;</span>/usr/lib64/lua/5.1/?.so<span class="p">;</span>/usr/lib64/lua/5.1/loadall.so<span class="p">;</span>
</span></span></code></pre></div><p>我们如果想使用别人写好的 lua 脚本，通常需要自己去对应的发布地址下载并自行安装，但是 lua 也有类似于模块管理器一样的软件 luarocks ，使用它我们可以更方便管理我们需要用到的模块，也可以把我们自己写好的脚本提供给他人下载使用。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 使用 luarocks 下载安装 luasql</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># --server 可以指定 luarocks 服务器</span>
</span></span><span class="line"><span class="cl">$ luarocks install luasql-mysql --server https://luarocks.cn <span class="nv">MYSQL_INCDIR</span><span class="o">=</span>/usr/include/mysql/ <span class="nv">MYSQL_LIBDIR</span><span class="o">=</span>/usr/lib64/mysql
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 编译过程可能需要指定一些依赖路径，可以通过环境变量来指定，具体变量信息可以在对应模块的 rockspec 查找</span>
</span></span><span class="line"><span class="cl"><span class="c1"># luasql-mysql rockspec </span>
</span></span><span class="line"><span class="cl"><span class="nv">package</span> <span class="o">=</span> <span class="s2">&#34;LuaSQL-MySQL&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">version</span> <span class="o">=</span> <span class="s2">&#34;2.3.5-1&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nb">source</span> <span class="o">=</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="nv">url</span> <span class="o">=</span> <span class="s2">&#34;git://github.com/keplerproject/luasql.git&#34;</span>,
</span></span><span class="line"><span class="cl">  <span class="nv">branch</span> <span class="o">=</span> <span class="s2">&#34;v2.3.5&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="nv">description</span> <span class="o">=</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">   <span class="nv">summary</span> <span class="o">=</span> <span class="s2">&#34;Database connectivity for Lua (MySQL driver)&#34;</span>,
</span></span><span class="line"><span class="cl">   <span class="nv">detailed</span> <span class="o">=</span> <span class="o">[[</span>
</span></span><span class="line"><span class="cl">      LuaSQL is a simple interface from Lua to a DBMS. It enables a
</span></span><span class="line"><span class="cl">      Lua program to connect to databases, execute arbitrary SQL statements
</span></span><span class="line"><span class="cl">      and retrieve results in a row-by-row cursor fashion.
</span></span><span class="line"><span class="cl">   <span class="o">]]</span>,
</span></span><span class="line"><span class="cl">   <span class="nv">license</span> <span class="o">=</span> <span class="s2">&#34;MIT/X11&#34;</span>,
</span></span><span class="line"><span class="cl">   <span class="nv">homepage</span> <span class="o">=</span> <span class="s2">&#34;http://www.keplerproject.org/luasql/&#34;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="nv">dependencies</span> <span class="o">=</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">   <span class="s2">&#34;lua &gt;= 5.1&#34;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="nv">external_dependencies</span> <span class="o">=</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">   <span class="nv">MYSQL</span> <span class="o">=</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">      <span class="nv">header</span> <span class="o">=</span> <span class="s2">&#34;mysql.h&#34;</span>
</span></span><span class="line"><span class="cl">   <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="nv">build</span> <span class="o">=</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">   <span class="nb">type</span> <span class="o">=</span> <span class="s2">&#34;builtin&#34;</span>,
</span></span><span class="line"><span class="cl">   <span class="nv">modules</span> <span class="o">=</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">     <span class="o">[</span><span class="s2">&#34;luasql.mysql&#34;</span><span class="o">]</span> <span class="o">=</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">       <span class="nv">sources</span> <span class="o">=</span> <span class="o">{</span> <span class="s2">&#34;src/luasql.c&#34;</span>, <span class="s2">&#34;src/ls_mysql.c&#34;</span> <span class="o">}</span>,
</span></span><span class="line"><span class="cl">       <span class="nv">libraries</span> <span class="o">=</span> <span class="o">{</span> <span class="s2">&#34;mysqlclient&#34;</span> <span class="o">}</span>,
</span></span><span class="line"><span class="cl">       <span class="nv">incdirs</span> <span class="o">=</span> <span class="o">{</span> <span class="s2">&#34;</span><span class="k">$(</span>MYSQL_INCDIR<span class="k">)</span><span class="s2">&#34;</span> <span class="o">}</span>,
</span></span><span class="line"><span class="cl">       <span class="nv">libdirs</span> <span class="o">=</span> <span class="o">{</span> <span class="s2">&#34;</span><span class="k">$(</span>MYSQL_LIBDIR<span class="k">)</span><span class="s2">&#34;</span> <span class="o">}</span>
</span></span><span class="line"><span class="cl">     <span class="o">}</span>
</span></span><span class="line"><span class="cl">   <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 为了维持解释器环境不被污染，可以使用 --tree 指定模块的安装路径</span>
</span></span><span class="line"><span class="cl">$ luarocks install luasql-mysql --tree <span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 如果不指定 --tree ，会根据当前用户决定安装路径</span>
</span></span><span class="line"><span class="cl"><span class="c1"># root 用户一般会将 lua 文件安装到 /usr/local/share/lua/ 中，而动态库文件则是 /usr/local/lib/lua/</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 删除已经安装的模块，必须指定 --tree</span>
</span></span><span class="line"><span class="cl">$ luarocks purge luasql-mysql --tree <span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span>
</span></span></code></pre></div><h2 id="lua-metatable">Lua Metatable</h2>
<p>lua metatable 经常用来定义模块。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="line"><span class="cl"><span class="kd">local</span> <span class="n">_M</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">_VERSION</span> <span class="o">=</span> <span class="s1">&#39;1.0&#39;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">local</span> <span class="n">mt</span> <span class="o">=</span> <span class="p">{</span> <span class="n">__index</span> <span class="o">=</span> <span class="n">_M</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">function</span> <span class="nc">_M</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="kr">return</span> <span class="n">setmetatable</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">     <span class="p">{</span>
</span></span><span class="line"><span class="cl">       <span class="n">left</span> <span class="o">=</span> <span class="n">left</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">       <span class="n">right</span> <span class="o">=</span> <span class="n">right</span>
</span></span><span class="line"><span class="cl">     <span class="p">},</span> <span class="n">mt</span>
</span></span><span class="line"><span class="cl">   <span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="kr">end</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">function</span> <span class="nc">_M</span><span class="p">:</span><span class="nf">add</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="kr">return</span> <span class="n">self.left</span> <span class="o">+</span> <span class="n">self.right</span>
</span></span><span class="line"><span class="cl"><span class="kr">end</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">function</span> <span class="nc">_M</span><span class="p">:</span><span class="nf">sub</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="kr">return</span> <span class="n">self.left</span> <span class="o">-</span> <span class="n">self.right</span>
</span></span><span class="line"><span class="cl"><span class="kr">end</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">function</span> <span class="nc">_M</span><span class="p">:</span><span class="nf">sum</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="kr">return</span> <span class="n">self.left</span> <span class="o">+</span> <span class="n">self.right</span> <span class="o">+</span> <span class="n">data</span>
</span></span><span class="line"><span class="cl"><span class="kr">end</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">return</span> <span class="n">_M</span>
</span></span></code></pre></div><p>上述代码定义了一个模块，其中 <code>_M.new()</code> 函数相当于对象的实例化，而它提供的方法有 <code>_M:add()</code> ， <code>_M:sub()</code> 和 <code>_M:sum()</code> 三种。</p>
<p>在通过 <code>local module = require(&quot;module_name&quot;)</code> 来引用模块之后，就可以使用具体的函数。其中而通过句号定义的函数会按照定义的参数内容传递参数，比如 <code>module.new(1, 2)</code> ，而通过冒号定义的函数定义默认会以自身作为第一个参数传入，比如 <code>module:add()</code> 实际上会直接返回计算结果。</p></article>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>
</div>
<script type="application/javascript" src='https://yuweizzz.github.io/js/toc.js'></script>
<link rel="stylesheet" href='https://yuweizzz.github.io/css/toc.css' />

  
</div>

  <div class="footer container-xl width-full p-responsive">
  <div
    class="position-relative d-flex flex-row-reverse flex-lg-row flex-wrap flex-lg-nowrap flex-justify-center flex-lg-justify-between flex-sm-items-center pt-6 pb-2 mt-6 f6 text-gray border-top border-gray-light ">
    <a aria-label="Homepage" title="GitHub" class="footer-octicon d-none d-lg-block mr-lg-4" href="https://yuweizzz.github.io/">
      <svg height="24" class="octicon octicon-mark-github" viewBox="0 0 16 16" version="1.1" width="24">
        <path fill-rule="evenodd"
          d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z">
        </path>
      </svg>
    </a>
    <ul class="list-style-none d-flex flex-wrap col-12 flex-justify-center flex-lg-justify-between mb-2 mb-lg-0">
      
      <li class="mr-3 mr-lg-0">Theme by <a href='https://github.com/MeiK2333/github-style'>github-style</a></li>
      
    </ul>
  </div>
  <div class="d-flex flex-justify-center pb-6">
    <span class="f6 text-gray-light"></span>
  </div>


</div>
</body>

<script type="application/javascript" src="https://yuweizzz.github.io/js/github-style.js"></script>





<script src="https://cdn.jsdelivr.net/npm/fuse.js/dist/fuse.min.js"></script>
<script type="application/javascript" src='https://yuweizzz.github.io/js/search.js'></script>


<script src="https://cubism.live2d.com/sdk-web/cubismcore/live2dcubismcore.min.js"></script>
<script type="text/javascript" src="https://yuweizzz.github.io/js/CustomLive2D.js"></script>


</html>